{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/components/CityPhaser.tsx"],"sourcesContent":["\"use client\";\n\nimport type * as PhaserType from \"phaser\";\nimport { useEffect, useRef, useState } from \"react\";\n\nconst MAP_TILE_SIZE = 64;\nconst PINCH_SCALE = 0.9;\nconst PLAYER_SPRITE_KEY = \"warriorblue-walk\";\nconst PLAYER_ANIM_KEY = \"warriorblue-walk-loop\";\nconst PLAYER_FRAME_WIDTH = 192;\nconst PLAYER_FRAME_HEIGHT = 192;\nconst PLAYER_TARGET_HEIGHT = 140;\nconst PLAYER_SCALE = PLAYER_TARGET_HEIGHT / PLAYER_FRAME_HEIGHT;\nconst PLAYER_SPEED = 220;\nconst TILE_SOURCES = [\n  { id: 0, key: \"city-tile-source-0\", path: \"/tilesets/tile1.png\" },\n  { id: 1, key: \"city-tile-source-1\", path: \"/tilesets/tile2.png\" },\n  { id: 2, key: \"city-tile-source-2\", path: \"/tilesets/tile3.png\" },\n  { id: 3, key: \"city-tile-source-3\", path: \"/tilesets/tile4.png\" },\n  { id: 4, key: \"city-tile-source-4\", path: \"/tilesets/tile5.png\" },\n  { id: 5, key: \"city-tile-source-5\", path: \"/tilesets/tile6.png\" }\n] as const;\n\ntype MapResponse = {\n  map: number[][];\n};\n\nconst dPad = [\n  { label: \"↑\", dx: 0, dy: -1, className: \"pad-up\" },\n  { label: \"↓\", dx: 0, dy: 1, className: \"pad-down\" },\n  { label: \"←\", dx: -1, dy: 0, className: \"pad-left\" },\n  { label: \"→\", dx: 1, dy: 0, className: \"pad-right\" }\n] as const;\n\nexport function CityPhaser() {\n  const ref = useRef<HTMLDivElement | null>(null);\n  const [mapData, setMapData] = useState<number[][] | null>(null);\n  const [feedback, setFeedback] = useState<string | null>(null);\n  const [showPad, setShowPad] = useState(false);\n  const [orientationHint, setOrientationHint] = useState(false);\n  const [virtualDirection, setVirtualDirection] = useState({ dx: 0, dy: 0 });\n  const virtualDirectionRef = useRef({ dx: 0, dy: 0 });\n\n  useEffect(() => {\n    virtualDirectionRef.current = virtualDirection;\n  }, [virtualDirection]);\n\n  useEffect(() => {\n    const handleResize = () => {\n      if (typeof window === \"undefined\") return;\n      const width = window.innerWidth;\n      const height = window.innerHeight;\n      setShowPad(width < 900);\n      setOrientationHint(width < 700 && height > width);\n    };\n    handleResize();\n    window.addEventListener(\"resize\", handleResize);\n    return () => {\n      window.removeEventListener(\"resize\", handleResize);\n    };\n  }, []);\n\n  useEffect(() => {\n    let active = true;\n    async function loadMap() {\n      try {\n        const response = await fetch(\"/api/city/map\", { cache: \"no-store\" });\n        if (!response.ok) {\n          throw new Error(await response.text());\n        }\n        const data = (await response.json()) as MapResponse;\n        if (active) {\n          setMapData(data.map);\n        }\n      } catch (err) {\n        if (active) {\n          setFeedback(err instanceof Error ? err.message : \"Falha ao carregar o mapa.\");\n        }\n      }\n    }\n    void loadMap();\n    return () => {\n      active = false;\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!ref.current || !mapData) return;\n    let game: PhaserType.Game | null = null;\n\n    (async () => {\n      const Phaser = await import(\"phaser\");\n      const mapReference = mapData;\n\n      class CityScene extends Phaser.Scene {\n        private cursors!: Phaser.Types.Input.Keyboard.CursorKeys;\n        private player!: Phaser.GameObjects.Sprite;\n        private floorLayer?: Phaser.Tilemaps.TilemapLayer;\n        private map?: Phaser.Tilemaps.Tilemap;\n\n        preload() {\n          TILE_SOURCES.forEach((source) => {\n            this.load.image(source.key, source.path);\n          });\n          this.load.spritesheet(PLAYER_SPRITE_KEY, \"/sprites/warriorblue/walk.png\", {\n            frameWidth: PLAYER_FRAME_WIDTH,\n            frameHeight: PLAYER_FRAME_HEIGHT\n          });\n        }\n\n        create() {\n          this.buildFloor();\n          this.createPlayer();\n          this.cursors = this.input.keyboard!.createCursorKeys();\n          this.cameras.main.setBounds(0, 0, this.map!.widthInPixels, this.map!.heightInPixels);\n          this.cameras.main.startFollow(this.player, true, 0.2, 0.2);\n        }\n\n        private buildFloor() {\n          this.createFloorTexture();\n          this.map = this.make.tilemap({\n            data: mapReference,\n            tileWidth: MAP_TILE_SIZE,\n            tileHeight: MAP_TILE_SIZE\n          });\n          const tileset = this.map.addTilesetImage(\n            \"city-floor\",\n            \"city-floor\",\n            MAP_TILE_SIZE,\n            MAP_TILE_SIZE,\n            0,\n            0\n          );\n          if (!tileset) {\n            throw new Error(\"Tileset da cidade não pôde ser carregado.\");\n          }\n          this.floorLayer = this.map.createLayer(0, tileset) ?? undefined;\n          this.floorLayer?.setOrigin(0);\n        }\n\n        private createFloorTexture() {\n          if (this.textures.exists(\"city-floor\")) return;\n          const canvas = this.textures.createCanvas(\n            \"city-floor\",\n            MAP_TILE_SIZE * TILE_SOURCES.length,\n            MAP_TILE_SIZE\n          );\n          if (!canvas) return;\n          const ctx = canvas.getContext();\n          if (!ctx) return;\n          TILE_SOURCES.forEach((source, index) => {\n            const sourceImage = this.textures.get(source.key).getSourceImage() as HTMLImageElement;\n            ctx.drawImage(\n              sourceImage,\n              0,\n              0,\n              sourceImage.width,\n              sourceImage.height,\n              index * MAP_TILE_SIZE,\n              0,\n              MAP_TILE_SIZE,\n              MAP_TILE_SIZE\n            );\n          });\n          canvas.refresh();\n        }\n\n        private createPlayer() {\n          if (!this.anims.exists(PLAYER_ANIM_KEY)) {\n            this.anims.create({\n              key: PLAYER_ANIM_KEY,\n              frames: this.anims.generateFrameNumbers(PLAYER_SPRITE_KEY, { start: 0, end: 5 }),\n              frameRate: 8,\n              repeat: -1\n            });\n          }\n          this.player = this.add.sprite(0, 0, PLAYER_SPRITE_KEY, 0);\n          this.player.setOrigin(0.5, 1);\n          this.player.setScale(PLAYER_SCALE);\n          this.player.setDepth(20);\n          this.player.setTint(0x8dd9ff);\n          this.player.setPosition(this.map!.widthInPixels / 2, this.map!.heightInPixels / 2);\n        }\n\n        update(_: number, delta: number) {\n          if (!this.player || !this.cursors || !this.map) return;\n\n          let dx = 0;\n          let dy = 0;\n\n          if (this.cursors.left?.isDown) dx -= 1;\n          if (this.cursors.right?.isDown) dx += 1;\n          if (this.cursors.up?.isDown) dy -= 1;\n          if (this.cursors.down?.isDown) dy += 1;\n\n          const virtual = virtualDirectionRef.current;\n          dx += virtual.dx;\n          dy += virtual.dy;\n\n          const length = Math.hypot(dx, dy) || 1;\n          dx /= length;\n          dy /= length;\n\n          if (dx < 0) {\n            this.player.setFlipX(true);\n          } else if (dx > 0) {\n            this.player.setFlipX(false);\n          }\n\n          const halfWidth = this.player.displayWidth / 2;\n          const halfHeight = this.player.displayHeight / 2;\n          const bounds = {\n            minX: halfWidth,\n            maxX: this.map.widthInPixels - halfWidth,\n            minY: halfHeight,\n            maxY: this.map.heightInPixels\n          };\n\n          this.player.x = Phaser.Math.Clamp(\n            this.player.x + dx * PLAYER_SPEED * (delta / 1000),\n            bounds.minX,\n            bounds.maxX\n          );\n          this.player.y = Phaser.Math.Clamp(\n            this.player.y + dy * PLAYER_SPEED * (delta / 1000),\n            bounds.minY,\n            bounds.maxY\n          );\n\n          const isMoving = dx !== 0 || dy !== 0;\n          if (isMoving) {\n            this.player.anims.play(PLAYER_ANIM_KEY, true);\n          } else if (this.player.anims.currentAnim) {\n            this.player.anims.stop();\n            this.player.setFrame(0);\n          }\n        }\n      }\n\n      const getSize = () => {\n        const containerWidth = ref.current?.clientWidth ?? window.innerWidth ?? 960;\n        const maxWidth = Math.min(containerWidth, 960);\n        const width = Math.max(640, maxWidth * PINCH_SCALE);\n        const height = Math.round(width * (9 / 16));\n        return { width, height };\n      };\n\n      const initialSize = getSize();\n      game = new Phaser.Game({\n        type: Phaser.AUTO,\n        width: initialSize.width,\n        height: initialSize.height,\n        parent: ref.current!,\n        backgroundColor: \"#1a0a05\",\n        scene: CityScene\n      });\n\n      const handleResize = () => {\n        const size = getSize();\n        game?.scale.resize(size.width, size.height);\n      };\n\n      window.addEventListener(\"resize\", handleResize);\n      const cleanup = () => window.removeEventListener(\"resize\", handleResize);\n      game.events?.once(\"destroy\", cleanup);\n    })();\n\n    return () => {\n      if (game) {\n        game.destroy(true);\n      }\n    };\n  }, [mapData]);\n\n  const startDirection = (dx: number, dy: number) => () => setVirtualDirection({ dx, dy });\n  const stopDirection = () => setVirtualDirection({ dx: 0, dy: 0 });\n\n  if (feedback) {\n    return <p>{feedback}</p>;\n  }\n\n  if (!mapData) {\n    return <p>Carregando mapa…</p>;\n  }\n\n  return (\n    <div className=\"relative\">\n      <div className=\"phaser-wrapper\" ref={ref} />\n      {orientationHint && (\n        <p className=\"orientation-hint\">Melhor experiência na horizontal — gire o dispositivo.</p>\n      )}\n      {showPad && (\n        <div className=\"virtual-pad\">\n          {dPad.map((button) => (\n            <button\n              key={button.className}\n              className={`virtual-pad-button ${button.className}`}\n              onPointerDown={startDirection(button.dx, button.dy)}\n              onPointerUp={stopDirection}\n              onPointerLeave={stopDirection}\n              onPointerCancel={stopDirection}\n              type=\"button\"\n              aria-label={`Mover ${button.label}`}\n            >\n              {button.label}\n            </button>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 384, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/clientApi.ts"],"sourcesContent":["const rawBase = process.env.NEXT_PUBLIC_API_URL?.trim() ?? \"\";\nconst API_BASE = /^https?:\\/\\//i.test(rawBase) ? rawBase.replace(/\\/$/, \"\") : \"\";\n\nfunction buildUrl(path: string) {\n  const normalizedPath = path.startsWith(\"/\") ? path : `/${path}`;\n  return `${API_BASE}${normalizedPath}`;\n}\n\nexport async function getJSON<T>(path: string) {\n  const response = await fetch(buildUrl(path), {\n    method: \"GET\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    cache: \"no-store\"\n  });\n\n  if (!response.ok) {\n    throw new Error(await response.text());\n  }\n\n  return (await response.json()) as T;\n}\n\nexport async function postJSON<T>(path: string, body: unknown) {\n  const response = await fetch(buildUrl(path), {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(body)\n  });\n\n  if (!response.ok) {\n    throw new Error(await response.text());\n  }\n\n  return (await response.json()) as T;\n}\n"],"names":[],"mappings":";;;;;;AAAA,MAAM,UAAU,4DAAiC,UAAU;AAC3D,MAAM,WAAW,gBAAgB,IAAI,CAAC,WAAW,QAAQ,OAAO,CAAC,OAAO,MAAM;AAE9E,SAAS,SAAS,IAAY;IAC5B,MAAM,iBAAiB,KAAK,UAAU,CAAC,OAAO,OAAO,CAAC,CAAC,EAAE,MAAM;IAC/D,OAAO,GAAG,WAAW,gBAAgB;AACvC;AAEO,eAAe,QAAW,IAAY;IAC3C,MAAM,WAAW,MAAM,MAAM,SAAS,OAAO;QAC3C,QAAQ;QACR,SAAS;YACP,gBAAgB;QAClB;QACA,OAAO;IACT;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,MAAM,SAAS,IAAI;IACrC;IAEA,OAAQ,MAAM,SAAS,IAAI;AAC7B;AAEO,eAAe,SAAY,IAAY,EAAE,IAAa;IAC3D,MAAM,WAAW,MAAM,MAAM,SAAS,OAAO;QAC3C,QAAQ;QACR,SAAS;YACP,gBAAgB;QAClB;QACA,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,MAAM,SAAS,IAAI;IACrC;IAEA,OAAQ,MAAM,SAAS,IAAI;AAC7B"}},
    {"offset": {"line": 426, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/components/OnlinePanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getJSON, postJSON } from \"@/lib/clientApi\";\n\ntype OnlinePresence = {\n  ownerId: string;\n  lastPing: string;\n};\n\nexport function OnlinePanel({ ownerId }: { ownerId: string }) {\n  const [list, setList] = useState<OnlinePresence[]>([]);\n\n  useEffect(() => {\n    let active = true;\n\n    async function load() {\n      try {\n        const presences = await getJSON<OnlinePresence[]>(\"/api/online/list\");\n        if (active) {\n          setList(presences);\n        }\n      } catch (err) {\n        console.warn(\"Falha ao carregar online\", err);\n      }\n    }\n\n    load();\n    const interval = setInterval(load, 10000);\n    return () => {\n      active = false;\n      clearInterval(interval);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!ownerId) {\n      return;\n    }\n\n    async function ping() {\n      try {\n        await postJSON(\"/api/online/ping\", { ownerId });\n      } catch (err) {\n        console.warn(\"Falha ao enviar ping\", err);\n      }\n    }\n\n    ping();\n    const interval = setInterval(ping, 10000);\n    return () => {\n      clearInterval(interval);\n    };\n  }, [ownerId]);\n\n  return (\n    <div>\n      <h3>Jogadores online ({list.length})</h3>\n      <ul className=\"list\">\n        {list.map((presence) => (\n          <li key={presence.ownerId}>\n            {presence.ownerId} — ping {new Date(presence.lastPing).toLocaleTimeString()}\n          </li>\n        ))}\n        {list.length === 0 && <li>Nenhum jogador ativo.</li>}\n      </ul>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAUO,SAAS,YAAY,EAAE,OAAO,EAAuB;IAC1D,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAmB,EAAE;IAErD,IAAA,kNAAS,EAAC;QACR,IAAI,SAAS;QAEb,eAAe;YACb,IAAI;gBACF,MAAM,YAAY,MAAM,IAAA,2HAAO,EAAmB;gBAClD,IAAI,QAAQ;oBACV,QAAQ;gBACV;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,IAAI,CAAC,4BAA4B;YAC3C;QACF;QAEA;QACA,MAAM,WAAW,YAAY,MAAM;QACnC,OAAO;YACL,SAAS;YACT,cAAc;QAChB;IACF,GAAG,EAAE;IAEL,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,SAAS;YACZ;QACF;QAEA,eAAe;YACb,IAAI;gBACF,MAAM,IAAA,4HAAQ,EAAC,oBAAoB;oBAAE;gBAAQ;YAC/C,EAAE,OAAO,KAAK;gBACZ,QAAQ,IAAI,CAAC,wBAAwB;YACvC;QACF;QAEA;QACA,MAAM,WAAW,YAAY,MAAM;QACnC,OAAO;YACL,cAAc;QAChB;IACF,GAAG;QAAC;KAAQ;IAEZ,qBACE,8OAAC;;0BACC,8OAAC;;oBAAG;oBAAmB,KAAK,MAAM;oBAAC;;;;;;;0BACnC,8OAAC;gBAAG,WAAU;;oBACX,KAAK,GAAG,CAAC,CAAC,yBACT,8OAAC;;gCACE,SAAS,OAAO;gCAAC;gCAAS,IAAI,KAAK,SAAS,QAAQ,EAAE,kBAAkB;;2BADlE,SAAS,OAAO;;;;;oBAI1B,KAAK,MAAM,KAAK,mBAAK,8OAAC;kCAAG;;;;;;;;;;;;;;;;;;AAIlC"}},
    {"offset": {"line": 530, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/components/InventoryPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getJSON, postJSON } from \"@/lib/clientApi\";\nimport type { InventoryItem } from \"@/lib/models\";\n\nconst presetItems = [\n  { id: \"potion-small\", name: \"Poção Pequena\", description: \"Restaura 20 HP\", quantity: 1 },\n  { id: \"axe-basic\", name: \"Machado Básico\", description: \"Ferramenta para cortar lenha\", quantity: 1 },\n  { id: \"seed-carrot\", name: \"Sementes de Cenoura\", description: \"Usadas na fazenda\", quantity: 5 }\n] as const;\n\nexport function InventoryPanel({ ownerId }: { ownerId: string }) {\n  const [items, setItems] = useState<InventoryItem[]>([]);\n  const [feedback, setFeedback] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!ownerId) {\n      setItems([]);\n      return;\n    }\n    loadInventory(ownerId);\n  }, [ownerId]);\n\n  async function loadInventory(id: string) {\n    try {\n      const response = await getJSON<InventoryItem[]>(`/api/inventory/get?ownerId=${id}`);\n      setItems(response);\n      setFeedback(null);\n    } catch (err) {\n      setFeedback(getMessage(err));\n    }\n  }\n\n  async function handleQuickAdd(item: typeof presetItems[number]) {\n    if (!ownerId) return;\n    try {\n      const response = await postJSON<InventoryItem[]>(\"/api/inventory/add\", {\n        ownerId,\n        item\n      });\n      setItems(response);\n      setFeedback(`${item.name} adicionado.`);\n    } catch (err) {\n      setFeedback(getMessage(err));\n    }\n  }\n\n  async function handleConsume(itemId: string) {\n    if (!ownerId) return;\n    try {\n      const response = await postJSON<InventoryItem[]>(\"/api/inventory/remove\", {\n        ownerId,\n        itemId,\n        quantity: 1\n      });\n      setItems(response);\n      setFeedback(\"Item consumido.\");\n    } catch (err) {\n      setFeedback(getMessage(err));\n    }\n  }\n\n  return (\n    <div>\n      <h3>Inventário</h3>\n      {feedback && <p>{feedback}</p>}\n      <ul className=\"list\">\n        {items.map((item) => (\n          <li key={item.id} className=\"flex items-center justify-between gap-4\">\n            <div>\n              <strong>{item.name}</strong> — {item.quantity}x\n            </div>\n            <button className=\"button\" type=\"button\" onClick={() => handleConsume(item.id)}>\n              Usar 1\n            </button>\n          </li>\n        ))}\n        {items.length === 0 && <li>Nenhum item registrado.</li>}\n      </ul>\n\n      <div style={{ marginTop: 16 }}>\n        <h4>Adicionar itens comuns</h4>\n        <div className=\"grid\" style={{ gridTemplateColumns: \"repeat(auto-fit,minmax(180px,1fr))\" }}>\n          {presetItems.map((item) => (\n            <button\n              key={item.id}\n              className=\"button\"\n              type=\"button\"\n              onClick={() => handleQuickAdd(item)}\n              style={{ textAlign: \"center\" }}\n            >\n              {item.name}\n            </button>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction getMessage(err: unknown) {\n  return err instanceof Error ? err.message : \"Erro no inventário\";\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAMA,MAAM,cAAc;IAClB;QAAE,IAAI;QAAgB,MAAM;QAAiB,aAAa;QAAkB,UAAU;IAAE;IACxF;QAAE,IAAI;QAAa,MAAM;QAAkB,aAAa;QAAgC,UAAU;IAAE;IACpG;QAAE,IAAI;QAAe,MAAM;QAAuB,aAAa;QAAqB,UAAU;IAAE;CACjG;AAEM,SAAS,eAAe,EAAE,OAAO,EAAuB;IAC7D,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAkB,EAAE;IACtD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAgB;IAExD,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,SAAS;YACZ,SAAS,EAAE;YACX;QACF;QACA,cAAc;IAChB,GAAG;QAAC;KAAQ;IAEZ,eAAe,cAAc,EAAU;QACrC,IAAI;YACF,MAAM,WAAW,MAAM,IAAA,2HAAO,EAAkB,CAAC,2BAA2B,EAAE,IAAI;YAClF,SAAS;YACT,YAAY;QACd,EAAE,OAAO,KAAK;YACZ,YAAY,WAAW;QACzB;IACF;IAEA,eAAe,eAAe,IAAgC;QAC5D,IAAI,CAAC,SAAS;QACd,IAAI;YACF,MAAM,WAAW,MAAM,IAAA,4HAAQ,EAAkB,sBAAsB;gBACrE;gBACA;YACF;YACA,SAAS;YACT,YAAY,GAAG,KAAK,IAAI,CAAC,YAAY,CAAC;QACxC,EAAE,OAAO,KAAK;YACZ,YAAY,WAAW;QACzB;IACF;IAEA,eAAe,cAAc,MAAc;QACzC,IAAI,CAAC,SAAS;QACd,IAAI;YACF,MAAM,WAAW,MAAM,IAAA,4HAAQ,EAAkB,yBAAyB;gBACxE;gBACA;gBACA,UAAU;YACZ;YACA,SAAS;YACT,YAAY;QACd,EAAE,OAAO,KAAK;YACZ,YAAY,WAAW;QACzB;IACF;IAEA,qBACE,8OAAC;;0BACC,8OAAC;0BAAG;;;;;;YACH,0BAAY,8OAAC;0BAAG;;;;;;0BACjB,8OAAC;gBAAG,WAAU;;oBACX,MAAM,GAAG,CAAC,CAAC,qBACV,8OAAC;4BAAiB,WAAU;;8CAC1B,8OAAC;;sDACC,8OAAC;sDAAQ,KAAK,IAAI;;;;;;wCAAU;wCAAI,KAAK,QAAQ;wCAAC;;;;;;;8CAEhD,8OAAC;oCAAO,WAAU;oCAAS,MAAK;oCAAS,SAAS,IAAM,cAAc,KAAK,EAAE;8CAAG;;;;;;;2BAJzE,KAAK,EAAE;;;;;oBASjB,MAAM,MAAM,KAAK,mBAAK,8OAAC;kCAAG;;;;;;;;;;;;0BAG7B,8OAAC;gBAAI,OAAO;oBAAE,WAAW;gBAAG;;kCAC1B,8OAAC;kCAAG;;;;;;kCACJ,8OAAC;wBAAI,WAAU;wBAAO,OAAO;4BAAE,qBAAqB;wBAAqC;kCACtF,YAAY,GAAG,CAAC,CAAC,qBAChB,8OAAC;gCAEC,WAAU;gCACV,MAAK;gCACL,SAAS,IAAM,eAAe;gCAC9B,OAAO;oCAAE,WAAW;gCAAS;0CAE5B,KAAK,IAAI;+BANL,KAAK,EAAE;;;;;;;;;;;;;;;;;;;;;;AAa1B;AAEA,SAAS,WAAW,GAAY;IAC9B,OAAO,eAAe,QAAQ,IAAI,OAAO,GAAG;AAC9C"}},
    {"offset": {"line": 733, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/components/ChatPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getJSON, postJSON } from \"@/lib/clientApi\";\nimport type { ChatMessage } from \"@/lib/models\";\n\nexport function ChatPanel({ ownerId: forcedOwnerId }: { ownerId?: string }) {\n  const [ownerId, setOwnerId] = useState(forcedOwnerId ?? \"\");\n  const [message, setMessage] = useState(\"\");\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    let active = true;\n    async function load() {\n      try {\n        const list = await getJSON<ChatMessage[]>(\"/api/chat/get\");\n        if (active) {\n          setMessages(list);\n        }\n      } catch (err) {\n        if (active) {\n          setError(getMessage(err));\n        }\n      }\n    }\n\n    load();\n    const interval = setInterval(load, 3000);\n    return () => {\n      active = false;\n      clearInterval(interval);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (forcedOwnerId) {\n      setOwnerId(forcedOwnerId);\n    }\n  }, [forcedOwnerId]);\n\n  async function handleSend(event: React.FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n    if (!ownerId) {\n      setError(\"Informe o ownerId para enviar ao chat.\");\n      return;\n    }\n    try {\n      await postJSON(\"/api/chat/send\", { ownerId, message });\n      setMessage(\"\");\n      setError(null);\n    } catch (err) {\n      setError(getMessage(err));\n    }\n  }\n\n  return (\n    <div>\n      <h3>Chat Global</h3>\n      {error && <p>{error}</p>}\n      <form onSubmit={handleSend}>\n        {!forcedOwnerId && (\n          <>\n            <label htmlFor=\"chat-owner\">Owner ID</label>\n            <input\n              id=\"chat-owner\"\n              value={ownerId}\n              onChange={(event) => setOwnerId(event.target.value)}\n              required\n            />\n          </>\n        )}\n        <label htmlFor=\"chat-message\">Mensagem</label>\n        <textarea\n          id=\"chat-message\"\n          value={message}\n          maxLength={280}\n          onChange={(event) => setMessage(event.target.value)}\n          required\n        />\n        <button className=\"button\">Enviar</button>\n      </form>\n      <ul className=\"list\" style={{ marginTop: 16 }}>\n        {messages.map((entry) => (\n          <li key={entry.id}>\n            <strong>{entry.ownerId}</strong>: {entry.message}{\" \"}\n            <small>{new Date(entry.createdAt).toLocaleTimeString()}</small>\n          </li>\n        ))}\n        {messages.length === 0 && <li>Nenhuma mensagem.</li>}\n      </ul>\n    </div>\n  );\n}\n\nfunction getMessage(err: unknown) {\n  return err instanceof Error ? err.message : \"Falha no chat\";\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAMO,SAAS,UAAU,EAAE,SAAS,aAAa,EAAwB;IACxE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC,iBAAiB;IACxD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAgB,EAAE;IAC1D,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAgB;IAElD,IAAA,kNAAS,EAAC;QACR,IAAI,SAAS;QACb,eAAe;YACb,IAAI;gBACF,MAAM,OAAO,MAAM,IAAA,2HAAO,EAAgB;gBAC1C,IAAI,QAAQ;oBACV,YAAY;gBACd;YACF,EAAE,OAAO,KAAK;gBACZ,IAAI,QAAQ;oBACV,SAAS,WAAW;gBACtB;YACF;QACF;QAEA;QACA,MAAM,WAAW,YAAY,MAAM;QACnC,OAAO;YACL,SAAS;YACT,cAAc;QAChB;IACF,GAAG,EAAE;IAEL,IAAA,kNAAS,EAAC;QACR,IAAI,eAAe;YACjB,WAAW;QACb;IACF,GAAG;QAAC;KAAc;IAElB,eAAe,WAAW,KAAuC;QAC/D,MAAM,cAAc;QACpB,IAAI,CAAC,SAAS;YACZ,SAAS;YACT;QACF;QACA,IAAI;YACF,MAAM,IAAA,4HAAQ,EAAC,kBAAkB;gBAAE;gBAAS;YAAQ;YACpD,WAAW;YACX,SAAS;QACX,EAAE,OAAO,KAAK;YACZ,SAAS,WAAW;QACtB;IACF;IAEA,qBACE,8OAAC;;0BACC,8OAAC;0BAAG;;;;;;YACH,uBAAS,8OAAC;0BAAG;;;;;;0BACd,8OAAC;gBAAK,UAAU;;oBACb,CAAC,+BACA;;0CACE,8OAAC;gCAAM,SAAQ;0CAAa;;;;;;0CAC5B,8OAAC;gCACC,IAAG;gCACH,OAAO;gCACP,UAAU,CAAC,QAAU,WAAW,MAAM,MAAM,CAAC,KAAK;gCAClD,QAAQ;;;;;;;;kCAId,8OAAC;wBAAM,SAAQ;kCAAe;;;;;;kCAC9B,8OAAC;wBACC,IAAG;wBACH,OAAO;wBACP,WAAW;wBACX,UAAU,CAAC,QAAU,WAAW,MAAM,MAAM,CAAC,KAAK;wBAClD,QAAQ;;;;;;kCAEV,8OAAC;wBAAO,WAAU;kCAAS;;;;;;;;;;;;0BAE7B,8OAAC;gBAAG,WAAU;gBAAO,OAAO;oBAAE,WAAW;gBAAG;;oBACzC,SAAS,GAAG,CAAC,CAAC,sBACb,8OAAC;;8CACC,8OAAC;8CAAQ,MAAM,OAAO;;;;;;gCAAU;gCAAG,MAAM,OAAO;gCAAE;8CAClD,8OAAC;8CAAO,IAAI,KAAK,MAAM,SAAS,EAAE,kBAAkB;;;;;;;2BAF7C,MAAM,EAAE;;;;;oBAKlB,SAAS,MAAM,KAAK,mBAAK,8OAAC;kCAAG;;;;;;;;;;;;;;;;;;AAItC;AAEA,SAAS,WAAW,GAAY;IAC9B,OAAO,eAAe,QAAQ,IAAI,OAAO,GAAG;AAC9C"}},
    {"offset": {"line": 926, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/components/BottomMenu.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\n\nconst menuLinks = [\n  { label: \"Admin\", path: \"/editor\" },\n  { label: \"Cidade\", path: \"/city\" },\n  { label: \"Casa\", path: \"/house\" },\n  { label: \"Fazenda\", path: \"/farm\" },\n  { label: \"Floresta\", path: \"/forest\" },\n  { label: \"Lojas\", path: \"/shops\" },\n  { label: \"Chat\", path: \"/chat\" }\n] as const;\n\nexport function BottomMenu() {\n  return (\n    <nav className=\"bottom-menu\">\n      {menuLinks.map((link) => (\n        <Link key={link.path} href={link.path}>\n          {link.label}\n        </Link>\n      ))}\n    </nav>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAIA,MAAM,YAAY;IAChB;QAAE,OAAO;QAAS,MAAM;IAAU;IAClC;QAAE,OAAO;QAAU,MAAM;IAAQ;IACjC;QAAE,OAAO;QAAQ,MAAM;IAAS;IAChC;QAAE,OAAO;QAAW,MAAM;IAAQ;IAClC;QAAE,OAAO;QAAY,MAAM;IAAU;IACrC;QAAE,OAAO;QAAS,MAAM;IAAS;IACjC;QAAE,OAAO;QAAQ,MAAM;IAAQ;CAChC;AAEM,SAAS;IACd,qBACE,8OAAC;QAAI,WAAU;kBACZ,UAAU,GAAG,CAAC,CAAC,qBACd,8OAAC,uKAAI;gBAAiB,MAAM,KAAK,IAAI;0BAClC,KAAK,KAAK;eADF,KAAK,IAAI;;;;;;;;;;AAM5B"}},
    {"offset": {"line": 986, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/app/city/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useSearchParams } from \"next/navigation\";\nimport { CityPhaser } from \"@/components/CityPhaser\";\nimport { OnlinePanel } from \"@/components/OnlinePanel\";\nimport { InventoryPanel } from \"@/components/InventoryPanel\";\nimport { ChatPanel } from \"@/components/ChatPanel\";\nimport { BottomMenu } from \"@/components/BottomMenu\";\nimport { getJSON } from \"@/lib/clientApi\";\nimport type { Character } from \"@/lib/models\";\n\nexport default function CityPage() {\n  const searchParams = useSearchParams();\n  const initialOwnerId = searchParams.get(\"ownerId\") ?? \"\";\n  const initialCharacterId = searchParams.get(\"characterId\") ?? \"\";\n\n  const [ownerId, setOwnerId] = useState(initialOwnerId);\n  const [characterId, setCharacterId] = useState(initialCharacterId);\n  const [characterInfo, setCharacterInfo] = useState<Character | null>(null);\n  const [feedback, setFeedback] = useState<string | null>(null);\n  const [loadingCharacter, setLoadingCharacter] = useState(false);\n\n  useEffect(() => {\n    setOwnerId(initialOwnerId);\n    setCharacterId(initialCharacterId);\n    if (initialOwnerId && initialCharacterId) {\n      void loadSelectedCharacter(initialOwnerId, initialCharacterId);\n    }\n  }, [initialOwnerId, initialCharacterId]);\n\n  async function loadSelectedCharacter(currentOwnerId: string, currentCharacterId: string) {\n    if (!currentOwnerId || !currentCharacterId) {\n      setCharacterInfo(null);\n      return;\n    }\n    setLoadingCharacter(true);\n    setFeedback(null);\n    try {\n      const data = await getJSON<Character>(\n        `/api/character/get?ownerId=${currentOwnerId}&characterId=${currentCharacterId}`\n      );\n      setCharacterInfo(data);\n    } catch (err) {\n      setCharacterInfo(null);\n      setFeedback(getMessage(err));\n    } finally {\n      setLoadingCharacter(false);\n    }\n  }\n\n  return (\n    <section>\n      <div className=\"card\">\n        <h2>Etapas 2 e 3 — Cidade com Phaser e Movimentação Básica</h2>\n        <p>\n          Esta é a primeira área após o login. Entre aqui somente através da tela inicial (botão\n          Entrar no primeiro mapa), que envia automaticamente o personagem escolhido.\n        </p>\n        {!ownerId || !characterId ? (\n          <p>Retorne à página inicial e selecione um personagem para receber acesso à cidade.</p>\n        ) : (\n          <>\n            {loadingCharacter && <p>Carregando personagem selecionado…</p>}\n            {feedback && <p>{feedback}</p>}\n            {characterInfo && (\n              <div style={{ marginTop: 12 }}>\n                <p>\n                  Personagem ativo: <strong>{characterInfo.name}</strong> (sprite {characterInfo.sprite}\n                  ) — nível {characterInfo.stats.level}\n                </p>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n      <div className=\"card\">\n        <p>\n          O piso utiliza os tiles <code>public/tilesets/tile1.png</code> até <code>tile6.png</code>\n          (100×100), todos reamostrados para blocos de 32 px no Phaser. O mapa foi ampliado e continua\n          responsivo — abra em tela cheia para explorar melhor.\n        </p>\n        <CityPhaser />\n      </div>\n      {ownerId && (\n        <div className=\"grid\">\n          <div className=\"card\">\n            <OnlinePanel ownerId={ownerId} />\n          </div>\n          <div className=\"card\">\n            <InventoryPanel ownerId={ownerId} />\n          </div>\n        </div>\n      )}\n      <div className=\"card\">\n        <ChatPanel ownerId={ownerId} />\n      </div>\n      {ownerId && <BottomMenu />}\n    </section>\n  );\n}\n\nfunction getMessage(err: unknown) {\n  return err instanceof Error ? err.message : \"Falha ao carregar personagem\";\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;;;;;;;;;;AAYe,SAAS;IACtB,MAAM,eAAe,IAAA,qJAAe;IACpC,MAAM,iBAAiB,aAAa,GAAG,CAAC,cAAc;IACtD,MAAM,qBAAqB,aAAa,GAAG,CAAC,kBAAkB;IAE9D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAC/C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAAmB;IACrE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAgB;IACxD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,iNAAQ,EAAC;IAEzD,IAAA,kNAAS,EAAC;QACR,WAAW;QACX,eAAe;QACf,IAAI,kBAAkB,oBAAoB;YACxC,KAAK,sBAAsB,gBAAgB;QAC7C;IACF,GAAG;QAAC;QAAgB;KAAmB;IAEvC,eAAe,sBAAsB,cAAsB,EAAE,kBAA0B;QACrF,IAAI,CAAC,kBAAkB,CAAC,oBAAoB;YAC1C,iBAAiB;YACjB;QACF;QACA,oBAAoB;QACpB,YAAY;QACZ,IAAI;YACF,MAAM,OAAO,MAAM,IAAA,2HAAO,EACxB,CAAC,2BAA2B,EAAE,eAAe,aAAa,EAAE,oBAAoB;YAElF,iBAAiB;QACnB,EAAE,OAAO,KAAK;YACZ,iBAAiB;YACjB,YAAY,WAAW;QACzB,SAAU;YACR,oBAAoB;QACtB;IACF;IAEA,qBACE,8OAAC;;0BACC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;kCAAG;;;;;;kCACJ,8OAAC;kCAAE;;;;;;oBAIF,CAAC,WAAW,CAAC,4BACZ,8OAAC;kCAAE;;;;;6CAEH;;4BACG,kCAAoB,8OAAC;0CAAE;;;;;;4BACvB,0BAAY,8OAAC;0CAAG;;;;;;4BAChB,+BACC,8OAAC;gCAAI,OAAO;oCAAE,WAAW;gCAAG;0CAC1B,cAAA,8OAAC;;wCAAE;sDACiB,8OAAC;sDAAQ,cAAc,IAAI;;;;;;wCAAU;wCAAU,cAAc,MAAM;wCAAC;wCAC3E,cAAc,KAAK,CAAC,KAAK;;;;;;;;;;;;;;;;;;;;0BAOhD,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;;4BAAE;0CACuB,8OAAC;0CAAK;;;;;;4BAAgC;0CAAK,8OAAC;0CAAK;;;;;;4BAAgB;;;;;;;kCAI3F,8OAAC,uIAAU;;;;;;;;;;;YAEZ,yBACC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC,yIAAW;4BAAC,SAAS;;;;;;;;;;;kCAExB,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC,+IAAc;4BAAC,SAAS;;;;;;;;;;;;;;;;;0BAI/B,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC,qIAAS;oBAAC,SAAS;;;;;;;;;;;YAErB,yBAAW,8OAAC,uIAAU;;;;;;;;;;;AAG7B;AAEA,SAAS,WAAW,GAAY;IAC9B,OAAO,eAAe,QAAQ,IAAI,OAAO,GAAG;AAC9C"}}]
}