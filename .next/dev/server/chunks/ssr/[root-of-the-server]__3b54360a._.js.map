{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/components/CityPhaser.tsx"],"sourcesContent":["\"use client\";\n\nimport * as Phaser from \"phaser\";\nimport { useEffect, useRef } from \"react\";\n\nconst MAP_TILE_SIZE = 32;\nconst MAP_WIDTH_TILES = 32;\nconst MAP_HEIGHT_TILES = 20;\nconst PINCH_SCALE = 0.9;\nconst PLAYER_SPRITE_KEY = \"warriorblue-walk\";\nconst PLAYER_ANIM_KEY = \"warriorblue-walk-loop\";\nconst PLAYER_FRAME_WIDTH = 192;\nconst PLAYER_FRAME_HEIGHT = 192;\nconst PLAYER_TARGET_HEIGHT = 98;\nconst PLAYER_SCALE = PLAYER_TARGET_HEIGHT / PLAYER_FRAME_HEIGHT;\nconst PLAYER_SPEED = 200;\nconst FLOOR_SOURCES = [\n  { key: \"city-tile-source-1\", path: \"/tilesets/tile1.png\" },\n  { key: \"city-tile-source-2\", path: \"/tilesets/tile2.png\" }\n];\n\nclass CityScene extends Phaser.Scene {\n  private cursors!: Phaser.Types.Input.Keyboard.CursorKeys;\n  private player!: Phaser.GameObjects.Sprite;\n  private floorLayer?: Phaser.Tilemaps.TilemapLayer;\n  private map?: Phaser.Tilemaps.Tilemap;\n  private mapOffset = { x: 0, y: 0 };\n  private facing: \"right\" | \"left\" = \"right\";\n\n  constructor() {\n    super(\"CityScene\");\n  }\n\n  preload() {\n    FLOOR_SOURCES.forEach((source) => {\n      this.load.image(source.key, source.path);\n    });\n    this.load.spritesheet(PLAYER_SPRITE_KEY, \"/sprites/warriorblue/walk.png\", {\n      frameWidth: PLAYER_FRAME_WIDTH,\n      frameHeight: PLAYER_FRAME_HEIGHT\n    });\n  }\n\n  create() {\n    this.buildFloor();\n    this.createPlayer();\n    this.cursors = this.input.keyboard!.createCursorKeys();\n\n    this.centerMap();\n    this.scale.on(\"resize\", this.handleResize, this);\n    this.events.once(Phaser.Scenes.Events.SHUTDOWN, () => {\n      this.scale.off(\"resize\", this.handleResize, this);\n    });\n  }\n\n  private handleResize(gameSize: Phaser.Structs.Size) {\n    this.centerMap(gameSize.width, gameSize.height);\n  }\n\n  private buildFloor() {\n    this.createFloorTexture();\n    const mapData = this.buildMapMatrix();\n    this.map = this.make.tilemap({\n      data: mapData,\n      tileWidth: MAP_TILE_SIZE,\n      tileHeight: MAP_TILE_SIZE\n    });\n    const tileset = this.map.addTilesetImage(\n      \"city-floor\",\n      \"city-floor\",\n      MAP_TILE_SIZE,\n      MAP_TILE_SIZE,\n      0,\n      0\n    );\n    if (!tileset) {\n      throw new Error(\"Tileset da cidade não pôde ser carregado.\");\n    }\n    this.floorLayer = this.map.createLayer(0, tileset) ?? undefined;\n    this.floorLayer?.setOrigin(0);\n  }\n\n  private buildMapMatrix() {\n    return Array.from({ length: MAP_HEIGHT_TILES }, (_, rowIndex) =>\n      Array.from({ length: MAP_WIDTH_TILES }, (_, columnIndex) => {\n        const isBorder =\n          rowIndex === 0 ||\n          columnIndex === 0 ||\n          rowIndex === MAP_HEIGHT_TILES - 1 ||\n          columnIndex === MAP_WIDTH_TILES - 1;\n        if (isBorder) return 1;\n        return Math.random() > 0.85 ? 1 : 0;\n      })\n    );\n  }\n\n  private createFloorTexture() {\n    if (this.textures.exists(\"city-floor\")) return;\n    const canvas = this.textures.createCanvas(\n      \"city-floor\",\n      MAP_TILE_SIZE * FLOOR_SOURCES.length,\n      MAP_TILE_SIZE\n    );\n    if (!canvas) return;\n    const ctx = canvas.getContext();\n    if (!ctx) return;\n    FLOOR_SOURCES.forEach((source, index) => {\n      const sourceImage = this.textures.get(source.key).getSourceImage() as HTMLImageElement;\n      ctx.drawImage(\n        sourceImage,\n        0,\n        0,\n        sourceImage.width,\n        sourceImage.height,\n        index * MAP_TILE_SIZE,\n        0,\n        MAP_TILE_SIZE,\n        MAP_TILE_SIZE\n      );\n    });\n    canvas.refresh();\n  }\n\n  private createPlayer() {\n    if (!this.anims.exists(PLAYER_ANIM_KEY)) {\n      this.anims.create({\n        key: PLAYER_ANIM_KEY,\n        frames: this.anims.generateFrameNumbers(PLAYER_SPRITE_KEY, { start: 0, end: 5 }),\n        frameRate: 8,\n        repeat: -1\n      });\n    }\n    this.player = this.add.sprite(0, 0, PLAYER_SPRITE_KEY, 0);\n    this.player.setOrigin(0.5, 1);\n    this.player.setScale(PLAYER_SCALE);\n    this.player.setDepth(20);\n  }\n\n  private centerMap(width = this.scale.width, height = this.scale.height) {\n    if (!this.map || !this.floorLayer || !this.player) return;\n    const mapWidth = this.map.widthInPixels;\n    const mapHeight = this.map.heightInPixels;\n    const offsetX = (width - mapWidth) / 2;\n    const offsetY = (height - mapHeight) / 2;\n    this.mapOffset = { x: offsetX, y: offsetY };\n    this.floorLayer.setPosition(offsetX, offsetY);\n    this.player.setPosition(offsetX + mapWidth / 2, offsetY + mapHeight / 2);\n  }\n\n  update(_: number, delta: number) {\n    if (!this.player || !this.cursors || !this.map) return;\n    const deltaSeconds = delta / 1000;\n    let dx = 0;\n    let dy = 0;\n\n    if (this.cursors.left?.isDown) dx -= 1;\n    if (this.cursors.right?.isDown) dx += 1;\n    if (this.cursors.up?.isDown) dy -= 1;\n    if (this.cursors.down?.isDown) dy += 1;\n\n    const length = Math.hypot(dx, dy) || 1;\n    dx /= length;\n    dy /= length;\n\n    if (dx < 0) {\n      this.facing = \"left\";\n      this.player.setFlipX(true);\n    } else if (dx > 0) {\n      this.facing = \"right\";\n      this.player.setFlipX(false);\n    } else if (dy !== 0) {\n      this.player.setFlipX(this.facing === \"left\");\n    }\n\n    const halfWidth = this.player.displayWidth / 2;\n    const halfHeight = this.player.displayHeight / 2;\n    const bounds = {\n      minX: this.mapOffset.x + halfWidth,\n      maxX: this.mapOffset.x + this.map.widthInPixels - halfWidth,\n      minY: this.mapOffset.y + halfHeight,\n      maxY: this.mapOffset.y + this.map.heightInPixels - halfHeight\n    };\n\n    this.player.x = Phaser.Math.Clamp(\n      this.player.x + dx * PLAYER_SPEED * deltaSeconds,\n      bounds.minX,\n      bounds.maxX\n    );\n    this.player.y = Phaser.Math.Clamp(\n      this.player.y + dy * PLAYER_SPEED * deltaSeconds,\n      bounds.minY,\n      bounds.maxY\n    );\n\n    const isMoving = dx !== 0 || dy !== 0;\n    if (isMoving) {\n      this.player.anims.play(PLAYER_ANIM_KEY, true);\n    } else if (this.player.anims.currentAnim) {\n      this.player.anims.stop();\n      this.player.setFrame(0);\n    }\n  }\n}\n\nexport function CityPhaser() {\n  const ref = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    if (!ref.current) return;\n\n    const getSize = () => {\n      const containerWidth = ref.current?.clientWidth ?? window.innerWidth ?? 960;\n      const maxWidth = Math.min(containerWidth, 960);\n      const width = Math.max(640, maxWidth * PINCH_SCALE);\n      const height = Math.round(width * (9 / 16));\n      return { width, height };\n    };\n\n    const initialSize = getSize();\n    const game = new Phaser.Game({\n      type: Phaser.AUTO,\n      width: initialSize.width,\n      height: initialSize.height,\n      parent: ref.current,\n      backgroundColor: \"#04070f\",\n      scene: CityScene\n    });\n\n    const handleResize = () => {\n      const size = getSize();\n      game.scale.resize(size.width, size.height);\n    };\n\n    window.addEventListener(\"resize\", handleResize);\n    return () => {\n      window.removeEventListener(\"resize\", handleResize);\n      game.destroy(true);\n    };\n  }, []);\n\n  return <div className=\"phaser-wrapper\" ref={ref} />;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 249, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/clientApi.ts"],"sourcesContent":["const API_BASE = process.env.NEXT_PUBLIC_API_URL ?? \"\";\n\nexport async function getJSON<T>(path: string) {\n  const response = await fetch(`${API_BASE}${path}`, {\n    method: \"GET\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    cache: \"no-store\"\n  });\n\n  if (!response.ok) {\n    throw new Error(await response.text());\n  }\n\n  return (await response.json()) as T;\n}\n\nexport async function postJSON<T>(path: string, body: unknown) {\n  const response = await fetch(`${API_BASE}${path}`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(body)\n  });\n\n  if (!response.ok) {\n    throw new Error(await response.text());\n  }\n\n  return (await response.json()) as T;\n}\n"],"names":[],"mappings":";;;;;;AAAA,MAAM,WAAW,iEAAmC;AAE7C,eAAe,QAAW,IAAY;IAC3C,MAAM,WAAW,MAAM,MAAM,GAAG,WAAW,MAAM,EAAE;QACjD,QAAQ;QACR,SAAS;YACP,gBAAgB;QAClB;QACA,OAAO;IACT;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,MAAM,SAAS,IAAI;IACrC;IAEA,OAAQ,MAAM,SAAS,IAAI;AAC7B;AAEO,eAAe,SAAY,IAAY,EAAE,IAAa;IAC3D,MAAM,WAAW,MAAM,MAAM,GAAG,WAAW,MAAM,EAAE;QACjD,QAAQ;QACR,SAAS;YACP,gBAAgB;QAClB;QACA,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,MAAM,SAAS,IAAI;IACrC;IAEA,OAAQ,MAAM,SAAS,IAAI;AAC7B"}},
    {"offset": {"line": 286, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/components/OnlinePanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getJSON, postJSON } from \"@/lib/clientApi\";\n\ntype OnlinePresence = {\n  ownerId: string;\n  lastPing: string;\n};\n\nexport function OnlinePanel({ ownerId }: { ownerId: string }) {\n  const [list, setList] = useState<OnlinePresence[]>([]);\n\n  useEffect(() => {\n    let active = true;\n\n    async function load() {\n      try {\n        const presences = await getJSON<OnlinePresence[]>(\"/api/online/list\");\n        if (active) {\n          setList(presences);\n        }\n      } catch (err) {\n        console.warn(\"Falha ao carregar online\", err);\n      }\n    }\n\n    load();\n    const interval = setInterval(load, 10000);\n    return () => {\n      active = false;\n      clearInterval(interval);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!ownerId) {\n      return;\n    }\n\n    async function ping() {\n      try {\n        await postJSON(\"/api/online/ping\", { ownerId });\n      } catch (err) {\n        console.warn(\"Falha ao enviar ping\", err);\n      }\n    }\n\n    ping();\n    const interval = setInterval(ping, 10000);\n    return () => {\n      clearInterval(interval);\n    };\n  }, [ownerId]);\n\n  return (\n    <div>\n      <h3>Jogadores online ({list.length})</h3>\n      <ul className=\"list\">\n        {list.map((presence) => (\n          <li key={presence.ownerId}>\n            {presence.ownerId} — ping {new Date(presence.lastPing).toLocaleTimeString()}\n          </li>\n        ))}\n        {list.length === 0 && <li>Nenhum jogador ativo.</li>}\n      </ul>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAUO,SAAS,YAAY,EAAE,OAAO,EAAuB;IAC1D,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAmB,EAAE;IAErD,IAAA,kNAAS,EAAC;QACR,IAAI,SAAS;QAEb,eAAe;YACb,IAAI;gBACF,MAAM,YAAY,MAAM,IAAA,2HAAO,EAAmB;gBAClD,IAAI,QAAQ;oBACV,QAAQ;gBACV;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,IAAI,CAAC,4BAA4B;YAC3C;QACF;QAEA;QACA,MAAM,WAAW,YAAY,MAAM;QACnC,OAAO;YACL,SAAS;YACT,cAAc;QAChB;IACF,GAAG,EAAE;IAEL,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,SAAS;YACZ;QACF;QAEA,eAAe;YACb,IAAI;gBACF,MAAM,IAAA,4HAAQ,EAAC,oBAAoB;oBAAE;gBAAQ;YAC/C,EAAE,OAAO,KAAK;gBACZ,QAAQ,IAAI,CAAC,wBAAwB;YACvC;QACF;QAEA;QACA,MAAM,WAAW,YAAY,MAAM;QACnC,OAAO;YACL,cAAc;QAChB;IACF,GAAG;QAAC;KAAQ;IAEZ,qBACE,8OAAC;;0BACC,8OAAC;;oBAAG;oBAAmB,KAAK,MAAM;oBAAC;;;;;;;0BACnC,8OAAC;gBAAG,WAAU;;oBACX,KAAK,GAAG,CAAC,CAAC,yBACT,8OAAC;;gCACE,SAAS,OAAO;gCAAC;gCAAS,IAAI,KAAK,SAAS,QAAQ,EAAE,kBAAkB;;2BADlE,SAAS,OAAO;;;;;oBAI1B,KAAK,MAAM,KAAK,mBAAK,8OAAC;kCAAG;;;;;;;;;;;;;;;;;;AAIlC"}},
    {"offset": {"line": 390, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/components/InventoryPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getJSON, postJSON } from \"@/lib/clientApi\";\nimport type { InventoryItem } from \"@/lib/models\";\n\nexport function InventoryPanel({ ownerId }: { ownerId: string }) {\n  const [items, setItems] = useState<InventoryItem[]>([]);\n  const [feedback, setFeedback] = useState<string | null>(null);\n  const [newItem, setNewItem] = useState({ id: \"\", name: \"\", quantity: 1 });\n  const [removeItemId, setRemoveItemId] = useState(\"\");\n  const [removeQty, setRemoveQty] = useState(1);\n\n  useEffect(() => {\n    if (!ownerId) {\n      setItems([]);\n      return;\n    }\n    loadInventory(ownerId);\n  }, [ownerId]);\n\n  async function loadInventory(id: string) {\n    try {\n      const response = await getJSON<InventoryItem[]>(`/api/inventory/get?ownerId=${id}`);\n      setItems(response);\n      setFeedback(null);\n    } catch (err) {\n      setFeedback(getMessage(err));\n    }\n  }\n\n  async function handleAdd(event: React.FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n    if (!ownerId) {\n      setFeedback(\"Informe um ownerId para manipular o inventário.\");\n      return;\n    }\n    const payload = {\n      ownerId,\n      item: {\n        id: newItem.id || makeId(),\n        name: newItem.name,\n        quantity: Number(newItem.quantity)\n      }\n    };\n    try {\n      const response = await postJSON<InventoryItem[]>(\"/api/inventory/add\", payload);\n      setItems(response);\n      setFeedback(\"Item adicionado.\");\n    } catch (err) {\n      setFeedback(getMessage(err));\n    }\n  }\n\n  async function handleRemove(event: React.FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n    if (!ownerId) {\n      setFeedback(\"Informe um ownerId para manipular o inventário.\");\n      return;\n    }\n    try {\n      const response = await postJSON<InventoryItem[]>(\"/api/inventory/remove\", {\n        ownerId,\n        itemId: removeItemId,\n        quantity: Number(removeQty)\n      });\n      setItems(response);\n      setFeedback(\"Item removido.\");\n    } catch (err) {\n      setFeedback(getMessage(err));\n    }\n  }\n\n  return (\n    <div>\n      <h3>Inventário</h3>\n      {feedback && <p>{feedback}</p>}\n      <ul className=\"list\">\n        {items.map((item) => (\n          <li key={item.id}>\n            <strong>{item.name}</strong> — {item.quantity}x ({item.id})\n          </li>\n        ))}\n        {items.length === 0 && <li>Nenhum item registrado.</li>}\n      </ul>\n\n      <div className=\"grid\">\n        <form onSubmit={handleAdd}>\n          <h4>Adicionar item</h4>\n          <label htmlFor=\"item-name\">Nome</label>\n          <input\n            id=\"item-name\"\n            required\n            value={newItem.name}\n            onChange={(event) => setNewItem((prev) => ({ ...prev, name: event.target.value }))}\n          />\n          <label htmlFor=\"item-quantity\">Quantidade</label>\n          <input\n            id=\"item-quantity\"\n            type=\"number\"\n            min={1}\n            value={newItem.quantity}\n            onChange={(event) =>\n              setNewItem((prev) => ({ ...prev, quantity: Number(event.target.value) }))\n            }\n          />\n          <button className=\"button\">Adicionar</button>\n        </form>\n        <form onSubmit={handleRemove}>\n          <h4>Remover item</h4>\n          <label htmlFor=\"remove-id\">ID do item</label>\n          <input\n            id=\"remove-id\"\n            required\n            value={removeItemId}\n            onChange={(event) => setRemoveItemId(event.target.value)}\n          />\n          <label htmlFor=\"remove-qty\">Quantidade</label>\n          <input\n            id=\"remove-qty\"\n            type=\"number\"\n            min={1}\n            value={removeQty}\n            onChange={(event) => setRemoveQty(Number(event.target.value))}\n          />\n          <button className=\"button\">Remover</button>\n        </form>\n      </div>\n    </div>\n  );\n}\n\nfunction getMessage(err: unknown) {\n  return err instanceof Error ? err.message : \"Erro desconhecido\";\n}\n\nfunction makeId() {\n  if (typeof crypto !== \"undefined\" && typeof crypto.randomUUID === \"function\") {\n    return crypto.randomUUID();\n  }\n  return `item-${Date.now()}`;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 678, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/app/city/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useSearchParams } from \"next/navigation\";\nimport { CityPhaser } from \"@/components/CityPhaser\";\nimport { OnlinePanel } from \"@/components/OnlinePanel\";\nimport { InventoryPanel } from \"@/components/InventoryPanel\";\nimport { getJSON } from \"@/lib/clientApi\";\nimport type { Character } from \"@/lib/models\";\n\nexport default function CityPage() {\n  const searchParams = useSearchParams();\n  const initialOwnerId = searchParams.get(\"ownerId\") ?? \"\";\n  const initialCharacterId = searchParams.get(\"characterId\") ?? \"\";\n\n  const [ownerId, setOwnerId] = useState(initialOwnerId);\n  const [characterId, setCharacterId] = useState(initialCharacterId);\n  const [characterInfo, setCharacterInfo] = useState<Character | null>(null);\n  const [feedback, setFeedback] = useState<string | null>(null);\n  const [loadingCharacter, setLoadingCharacter] = useState(false);\n\n  useEffect(() => {\n    setOwnerId(initialOwnerId);\n    setCharacterId(initialCharacterId);\n    if (initialOwnerId && initialCharacterId) {\n      void loadSelectedCharacter(initialOwnerId, initialCharacterId);\n    }\n  }, [initialOwnerId, initialCharacterId]);\n\n  async function loadSelectedCharacter(currentOwnerId: string, currentCharacterId: string) {\n    if (!currentOwnerId || !currentCharacterId) {\n      setCharacterInfo(null);\n      return;\n    }\n    setLoadingCharacter(true);\n    setFeedback(null);\n    try {\n      const data = await getJSON<Character>(\n        `/api/character/get?ownerId=${currentOwnerId}&characterId=${currentCharacterId}`\n      );\n      setCharacterInfo(data);\n    } catch (err) {\n      setCharacterInfo(null);\n      setFeedback(getMessage(err));\n    } finally {\n      setLoadingCharacter(false);\n    }\n  }\n\n  return (\n    <section>\n      <div className=\"card\">\n        <h2>Etapas 2 e 3 — Cidade com Phaser e Movimentação Básica</h2>\n        <p>\n          Esta é a primeira área após o login. Entre aqui somente através da tela inicial (botão\n          Entrar no primeiro mapa), que envia automaticamente o personagem escolhido.\n        </p>\n        {!ownerId || !characterId ? (\n          <p>Retorne à página inicial e selecione um personagem para receber acesso à cidade.</p>\n        ) : (\n          <>\n            {loadingCharacter && <p>Carregando personagem selecionado…</p>}\n            {feedback && <p>{feedback}</p>}\n            {characterInfo && (\n              <div style={{ marginTop: 12 }}>\n                <p>\n                  Personagem ativo: <strong>{characterInfo.name}</strong> (sprite {characterInfo.sprite}\n                  ) — nível {characterInfo.stats.level}\n                </p>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n      <div className=\"card\">\n        <p>\n          O piso utiliza <code>public/tilesets/tile1.png</code> e <code>tile2.png</code> (100×100 cada),\n          reamostrados para blocos de 32 px no Phaser. O mapa foi ampliado e continua responsivo —\n          abra em tela cheia para explorar melhor.\n        </p>\n        <CityPhaser />\n      </div>\n      <div className=\"grid\">\n        <div className=\"card\">\n          <OnlinePanel ownerId={ownerId} />\n        </div>\n        <div className=\"card\">\n          <InventoryPanel ownerId={ownerId} />\n        </div>\n      </div>\n    </section>\n  );\n}\n\nfunction getMessage(err: unknown) {\n  return err instanceof Error ? err.message : \"Falha ao carregar personagem\";\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAPA;;;;;;;;AAUe,SAAS;IACtB,MAAM,eAAe,IAAA,qJAAe;IACpC,MAAM,iBAAiB,aAAa,GAAG,CAAC,cAAc;IACtD,MAAM,qBAAqB,aAAa,GAAG,CAAC,kBAAkB;IAE9D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAC/C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAAmB;IACrE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAgB;IACxD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,iNAAQ,EAAC;IAEzD,IAAA,kNAAS,EAAC;QACR,WAAW;QACX,eAAe;QACf,IAAI,kBAAkB,oBAAoB;YACxC,KAAK,sBAAsB,gBAAgB;QAC7C;IACF,GAAG;QAAC;QAAgB;KAAmB;IAEvC,eAAe,sBAAsB,cAAsB,EAAE,kBAA0B;QACrF,IAAI,CAAC,kBAAkB,CAAC,oBAAoB;YAC1C,iBAAiB;YACjB;QACF;QACA,oBAAoB;QACpB,YAAY;QACZ,IAAI;YACF,MAAM,OAAO,MAAM,IAAA,2HAAO,EACxB,CAAC,2BAA2B,EAAE,eAAe,aAAa,EAAE,oBAAoB;YAElF,iBAAiB;QACnB,EAAE,OAAO,KAAK;YACZ,iBAAiB;YACjB,YAAY,WAAW;QACzB,SAAU;YACR,oBAAoB;QACtB;IACF;IAEA,qBACE,8OAAC;;0BACC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;kCAAG;;;;;;kCACJ,8OAAC;kCAAE;;;;;;oBAIF,CAAC,WAAW,CAAC,4BACZ,8OAAC;kCAAE;;;;;6CAEH;;4BACG,kCAAoB,8OAAC;0CAAE;;;;;;4BACvB,0BAAY,8OAAC;0CAAG;;;;;;4BAChB,+BACC,8OAAC;gCAAI,OAAO;oCAAE,WAAW;gCAAG;0CAC1B,cAAA,8OAAC;;wCAAE;sDACiB,8OAAC;sDAAQ,cAAc,IAAI;;;;;;wCAAU;wCAAU,cAAc,MAAM;wCAAC;wCAC3E,cAAc,KAAK,CAAC,KAAK;;;;;;;;;;;;;;;;;;;;0BAOhD,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;;4BAAE;0CACc,8OAAC;0CAAK;;;;;;4BAAgC;0CAAG,8OAAC;0CAAK;;;;;;4BAAgB;;;;;;;kCAIhF,8OAAC,uIAAU;;;;;;;;;;;0BAEb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC,yIAAW;4BAAC,SAAS;;;;;;;;;;;kCAExB,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC,+IAAc;4BAAC,SAAS;;;;;;;;;;;;;;;;;;;;;;;AAKnC;AAEA,SAAS,WAAW,GAAY;IAC9B,OAAO,eAAe,QAAQ,IAAI,OAAO,GAAG;AAC9C"}}]
}