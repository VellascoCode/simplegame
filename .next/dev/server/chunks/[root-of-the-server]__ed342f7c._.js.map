{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/apiResponse.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\nexport function ok<T>(data: T, status = 200) {\n  return NextResponse.json(data, { status });\n}\n\nexport function error(message: string, status = 400) {\n  return NextResponse.json({ error: message }, { status });\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,SAAS,GAAM,IAAO,EAAE,SAAS,GAAG;IACzC,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM;QAAE;IAAO;AAC1C;AAEO,SAAS,MAAM,OAAe,EAAE,SAAS,GAAG;IACjD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAQ,GAAG;QAAE;IAAO;AACxD"}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/db.ts"],"sourcesContent":["import { MongoClient, Collection, type Document } from \"mongodb\";\n\nlet client: MongoClient | null = null;\n\nconst uri = process.env.MONGODB_URI;\nconst parsedDbName = (() => {\n  if (!uri) return null;\n  try {\n    const url = new URL(uri);\n    const pathname = url.pathname.replace(/^\\//, \"\");\n    return pathname || null;\n  } catch {\n    return null;\n  }\n})();\n\nasync function getClient() {\n  if (!uri) {\n    throw new Error(\"MONGODB_URI n√£o configurado\");\n  }\n\n  if (!client) {\n    client = new MongoClient(uri);\n    await client.connect();\n  }\n\n  return client;\n}\n\nexport async function getCollection<T extends Document = Document>(\n  name: string\n): Promise<Collection<T>> {\n  const cli = await getClient();\n  const dbName = process.env.MONGODB_DB || parsedDbName || \"simpleapp\";\n  return cli.db(dbName).collection<T>(name);\n}\n\nexport function hasMongoConnection() {\n  return Boolean(uri);\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,SAA6B;AAEjC,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,eAAe,CAAC;IACpB,IAAI,CAAC,KAAK,OAAO;IACjB,IAAI;QACF,MAAM,MAAM,IAAI,IAAI;QACpB,MAAM,WAAW,IAAI,QAAQ,CAAC,OAAO,CAAC,OAAO;QAC7C,OAAO,YAAY;IACrB,EAAE,OAAM;QACN,OAAO;IACT;AACF,CAAC;AAED,eAAe;IACb,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,CAAC,QAAQ;QACX,SAAS,IAAI,sHAAW,CAAC;QACzB,MAAM,OAAO,OAAO;IACtB;IAEA,OAAO;AACT;AAEO,eAAe,cACpB,IAAY;IAEZ,MAAM,MAAM,MAAM;IAClB,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI,gBAAgB;IACzD,OAAO,IAAI,EAAE,CAAC,QAAQ,UAAU,CAAI;AACtC;AAEO,SAAS;IACd,OAAO,QAAQ;AACjB"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/memoryStore.ts"],"sourcesContent":["import type {\n  ChatMessage,\n  Character,\n  FarmState,\n  HouseState,\n  InventoryItem,\n  OnlinePresence,\n  PlayerSessionState,\n  QuickSlotLayout,\n  User\n} from \"./models\";\n\ntype MemoryDB = {\n  users: User[];\n  characters: Character[];\n  inventory: Record<string, InventoryItem[]>;\n  houses: HouseState[];\n  farms: FarmState[];\n  chat: ChatMessage[];\n  online: OnlinePresence[];\n  sessions: PlayerSessionState[];\n  quickSlots: QuickSlotLayout[];\n};\n\nconst memoryDb: MemoryDB = {\n  users: [],\n  characters: [],\n  inventory: {},\n  houses: [],\n  farms: [],\n  chat: [],\n  online: [],\n  sessions: [],\n  quickSlots: []\n};\n\nexport function getMemoryDB() {\n  return memoryDb;\n}\n"],"names":[],"mappings":";;;;AAwBA,MAAM,WAAqB;IACzB,OAAO,EAAE;IACT,YAAY,EAAE;IACd,WAAW,CAAC;IACZ,QAAQ,EAAE;IACV,OAAO,EAAE;IACT,MAAM,EAAE;IACR,QAAQ,EAAE;IACV,UAAU,EAAE;IACZ,YAAY,EAAE;AAChB;AAEO,SAAS;IACd,OAAO;AACT"}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/repositories.ts"],"sourcesContent":["import { ObjectId, type OptionalUnlessRequiredId } from \"mongodb\";\nimport { getCollection, hasMongoConnection } from \"./db\";\nimport { getMemoryDB } from \"./memoryStore\";\nimport type {\n  ChatMessage,\n  Character,\n  FarmState,\n  HouseState,\n  InventoryItem,\n  OnlinePresence,\n  PlayerSessionState,\n  QuickSlotLayout,\n  User\n} from \"./models\";\n\ntype CharacterDocument = Omit<Character, \"_id\"> & { _id: ObjectId };\ntype UserDocument = Omit<User, \"_id\"> & { _id: ObjectId };\n\nexport async function findUserByEmail(email: string) {\n  if (hasMongoConnection()) {\n    const users = await getCollection<UserDocument>(\"users\");\n    const doc = await users.findOne({ email });\n    return doc ? normalizeUser(doc) : null;\n  }\n\n  const memory = getMemoryDB();\n  return memory.users.find((user) => user.email === email) ?? null;\n}\n\nexport async function insertUser(user: User) {\n  if (hasMongoConnection()) {\n    const users = await getCollection<UserDocument>(\"users\");\n    const { _id, ...doc } = user;\n    const result = await users.insertOne(doc as OptionalUnlessRequiredId<UserDocument>);\n    return { ...doc, _id: String(result.insertedId) };\n  }\n\n  const memory = getMemoryDB();\n  const stored = { ...user, _id: new ObjectId().toHexString() };\n  memory.users.push(stored);\n  return stored;\n}\n\nexport async function countCharacters(ownerId: string) {\n  if (hasMongoConnection()) {\n    const characters = await getCollection<CharacterDocument>(\"characters\");\n    return characters.countDocuments({ ownerId });\n  }\n\n  const memory = getMemoryDB();\n  return memory.characters.filter((c) => c.ownerId === ownerId).length;\n}\n\nexport async function insertCharacter(character: Character) {\n  if (hasMongoConnection()) {\n    const characters = await getCollection<CharacterDocument>(\"characters\");\n    const { _id, ...doc } = character;\n    const result = await characters.insertOne(\n      doc as OptionalUnlessRequiredId<CharacterDocument>\n    );\n    return { ...doc, _id: String(result.insertedId) };\n  }\n\n  const memory = getMemoryDB();\n  const stored = { ...character, _id: new ObjectId().toHexString() };\n  memory.characters.push(stored);\n  return stored;\n}\n\nexport async function listCharacters(ownerId: string) {\n  if (hasMongoConnection()) {\n    const characters = await getCollection<CharacterDocument>(\"characters\");\n    const docs = await characters\n      .find({ ownerId })\n      .sort({ createdAt: 1 })\n      .limit(4)\n      .toArray();\n    return docs.map((doc) => normalizeCharacter(doc));\n  }\n\n  const memory = getMemoryDB();\n  return memory.characters.filter((c) => c.ownerId === ownerId).map((c) => ({ ...c }));\n}\n\nexport async function findCharacterById(ownerId: string, characterId: string) {\n  if (hasMongoConnection()) {\n    if (!ObjectId.isValid(characterId)) {\n      return null;\n    }\n    const characters = await getCollection<CharacterDocument>(\"characters\");\n    const doc = await characters.findOne({ ownerId, _id: new ObjectId(characterId) });\n    return doc ? normalizeCharacter(doc) : null;\n  }\n\n  const memory = getMemoryDB();\n  const character = memory.characters.find(\n    (c) => c.ownerId === ownerId && c._id === characterId\n  );\n  return character ? { ...character } : null;\n}\n\nexport async function getInventory(ownerId: string) {\n  if (hasMongoConnection()) {\n    const inventory = await getCollection<{ ownerId: string; items: InventoryItem[] }>(\"inventory\");\n    const doc = await inventory.findOne({ ownerId });\n    return doc?.items ?? [];\n  }\n\n  const memory = getMemoryDB();\n  const items = memory.inventory[ownerId] ?? [];\n  memory.inventory[ownerId] = items;\n  return items;\n}\n\nexport async function saveInventory(ownerId: string, items: InventoryItem[]) {\n  if (hasMongoConnection()) {\n    const inventory = await getCollection<{ ownerId: string; items: InventoryItem[] }>(\"inventory\");\n    await inventory.updateOne(\n      { ownerId },\n      { $set: { ownerId, items } },\n      { upsert: true }\n    );\n    return items;\n  }\n\n  const memory = getMemoryDB();\n  memory.inventory[ownerId] = items;\n  return items;\n}\n\nexport async function getHouse(ownerId: string): Promise<HouseState> {\n  if (hasMongoConnection()) {\n    const houses = await getCollection<HouseState>(\"houses\");\n    const doc = await houses.findOne({ ownerId });\n    return (\n      doc ?? {\n        ownerId,\n        furniture: defaultFurniture()\n      }\n    );\n  }\n\n  const memory = getMemoryDB();\n  let house = memory.houses.find((h) => h.ownerId === ownerId);\n  if (!house) {\n    house = { ownerId, furniture: defaultFurniture() };\n    memory.houses.push(house);\n  }\n  return house;\n}\n\nexport async function updateHouse(ownerId: string, furniture: HouseState[\"furniture\"]) {\n  const state = { ownerId, furniture };\n  if (hasMongoConnection()) {\n    const houses = await getCollection<HouseState>(\"houses\");\n    await houses.updateOne({ ownerId }, { $set: state }, { upsert: true });\n    return state;\n  }\n\n  const memory = getMemoryDB();\n  const index = memory.houses.findIndex((h) => h.ownerId === ownerId);\n  if (index >= 0) {\n    memory.houses[index] = state;\n    return state;\n  }\n  memory.houses.push(state);\n  return state;\n}\n\nexport async function getFarm(ownerId: string): Promise<FarmState> {\n  if (hasMongoConnection()) {\n    const farms = await getCollection<FarmState>(\"farms\");\n    const doc = await farms.findOne({ ownerId });\n    return doc ?? { ownerId, plots: defaultFarmPlots() };\n  }\n\n  const memory = getMemoryDB();\n  let farm = memory.farms.find((f) => f.ownerId === ownerId);\n  if (!farm) {\n    farm = { ownerId, plots: defaultFarmPlots() };\n    memory.farms.push(farm);\n  }\n  return farm;\n}\n\nexport async function saveFarm(state: FarmState) {\n  if (hasMongoConnection()) {\n    const farms = await getCollection<FarmState>(\"farms\");\n    await farms.updateOne({ ownerId: state.ownerId }, { $set: state }, { upsert: true });\n    return state;\n  }\n\n  const memory = getMemoryDB();\n  const index = memory.farms.findIndex((f) => f.ownerId === state.ownerId);\n  if (index >= 0) {\n    memory.farms[index] = state;\n    return state;\n  }\n  memory.farms.push(state);\n  return state;\n}\n\nexport async function getPlayerSession(ownerId: string) {\n  if (hasMongoConnection()) {\n    const sessions = await getCollection<PlayerSessionState>(\"sessions\");\n    return sessions.findOne({ ownerId });\n  }\n\n  const memory = getMemoryDB();\n  return memory.sessions.find((session) => session.ownerId === ownerId) ?? null;\n}\n\nexport async function savePlayerSession(state: PlayerSessionState) {\n  const payload = { ...state, updatedAt: new Date().toISOString() };\n  if (hasMongoConnection()) {\n    const sessions = await getCollection<PlayerSessionState>(\"sessions\");\n    await sessions.updateOne({ ownerId: state.ownerId }, { $set: payload }, { upsert: true });\n    return payload;\n  }\n\n  const memory = getMemoryDB();\n  const index = memory.sessions.findIndex((session) => session.ownerId === state.ownerId);\n  if (index >= 0) {\n    memory.sessions[index] = payload;\n  } else {\n    memory.sessions.push(payload);\n  }\n  return payload;\n}\n\nexport async function clearPlayerSession(ownerId: string) {\n  if (hasMongoConnection()) {\n    const sessions = await getCollection<PlayerSessionState>(\"sessions\");\n    await sessions.deleteOne({ ownerId });\n    return;\n  }\n\n  const memory = getMemoryDB();\n  memory.sessions = memory.sessions.filter((session) => session.ownerId !== ownerId);\n}\n\nexport async function getQuickSlots(ownerId: string) {\n  if (hasMongoConnection()) {\n    const layout = await getCollection<QuickSlotLayout>(\"quickslots\");\n    const doc = await layout.findOne({ ownerId });\n    return doc?.slots ?? defaultQuickSlots();\n  }\n\n  const memory = getMemoryDB();\n  const existing = memory.quickSlots.find((slot) => slot.ownerId === ownerId);\n  if (!existing) {\n    const created = { ownerId, slots: defaultQuickSlots(), updatedAt: new Date().toISOString() };\n    memory.quickSlots.push(created);\n    return created.slots;\n  }\n  return existing.slots;\n}\n\nexport async function saveQuickSlots(ownerId: string, slots: Array<string | null>) {\n  const payload: QuickSlotLayout = {\n    ownerId,\n    slots,\n    updatedAt: new Date().toISOString()\n  };\n  if (hasMongoConnection()) {\n    const layout = await getCollection<QuickSlotLayout>(\"quickslots\");\n    await layout.updateOne({ ownerId }, { $set: payload }, { upsert: true });\n    return payload.slots;\n  }\n\n  const memory = getMemoryDB();\n  const index = memory.quickSlots.findIndex((slot) => slot.ownerId === ownerId);\n  if (index >= 0) {\n    memory.quickSlots[index] = payload;\n  } else {\n    memory.quickSlots.push(payload);\n  }\n  return payload.slots;\n}\n\nexport async function addChatMessage(message: ChatMessage) {\n  if (hasMongoConnection()) {\n    const chat = await getCollection<ChatMessage>(\"chat\");\n    await chat.insertOne(message);\n    return message;\n  }\n\n  const memory = getMemoryDB();\n  memory.chat.push(message);\n  memory.chat = memory.chat.slice(-50);\n  return message;\n}\n\nexport async function listChatMessages(limit = 20) {\n  if (hasMongoConnection()) {\n    const chat = await getCollection<ChatMessage>(\"chat\");\n    const docs = await chat.find({}, { sort: { createdAt: -1 } }).limit(limit).toArray();\n    return docs.reverse();\n  }\n\n  const memory = getMemoryDB();\n  return memory.chat.slice(-limit);\n}\n\nexport async function pingOnline(ownerId: string) {\n  const entry: OnlinePresence = { ownerId, lastPing: new Date().toISOString() };\n  if (hasMongoConnection()) {\n    const online = await getCollection<OnlinePresence>(\"online\");\n    await online.updateOne({ ownerId }, { $set: entry }, { upsert: true });\n    return entry;\n  }\n\n  const memory = getMemoryDB();\n  const index = memory.online.findIndex((o) => o.ownerId === ownerId);\n  if (index >= 0) {\n    memory.online[index] = entry;\n  } else {\n    memory.online.push(entry);\n  }\n  return entry;\n}\n\nexport async function listOnline() {\n  const cutoff = Date.now() - 1000 * 60;\n  if (hasMongoConnection()) {\n    const online = await getCollection<OnlinePresence>(\"online\");\n    const docs = await online\n      .find({ lastPing: { $gte: new Date(cutoff).toISOString() } })\n      .toArray();\n    return docs;\n  }\n\n  const memory = getMemoryDB();\n  return memory.online.filter((o) => new Date(o.lastPing).getTime() >= cutoff);\n}\n\nfunction normalizeCharacter(\n  doc: CharacterDocument | (Character & { _id?: any })\n): Character {\n  const normalizedId =\n    typeof doc._id === \"string\" ? doc._id : doc._id?.toString?.();\n  return {\n    ...(structuredCloneCharacter(doc)),\n    _id: normalizedId\n  };\n}\n\nfunction normalizeUser(doc: UserDocument): User {\n  const normalizedId =\n    typeof doc._id === \"string\" ? doc._id : doc._id?.toString?.();\n  return {\n    ...(structuredCloneUser(doc)),\n    _id: normalizedId\n  };\n}\n\nfunction structuredCloneCharacter(\n  doc: CharacterDocument | (Character & { _id?: any })\n): Character {\n  const { _id, ...rest } = doc as Character;\n  return { ...rest };\n}\n\nfunction structuredCloneUser(doc: UserDocument | (User & { _id?: any })): User {\n  const { _id, ...rest } = doc as User;\n  return { ...rest };\n}\n\nfunction defaultFurniture() {\n  return [\n    { id: \"bed\", name: \"Cama Simples\", position: { x: 64, y: 32 } },\n    { id: \"table\", name: \"Mesa Madeira\", position: { x: 32, y: 96 } },\n    { id: \"shelf\", name: \"Estante Pequena\", position: { x: 96, y: 32 } },\n    { id: \"lamp\", name: \"Lamparina\", position: { x: 128, y: 96 } }\n  ];\n}\n\nfunction defaultQuickSlots(): Array<string | null> {\n  return [null, null, null, null];\n}\n\nfunction defaultFarmPlots() {\n  return Array.from({ length: 4 }).map((_, index) => ({\n    id: `plot-${index + 1}`,\n    seed: null,\n    plantedAt: null,\n    harvestReadyAt: null\n  }));\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 702, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/hash.ts"],"sourcesContent":["import { createHash, randomBytes } from \"crypto\";\n\nexport type PasswordBundle = {\n  hash: string;\n  salt: string;\n};\n\nexport function hashPassword(password: string): PasswordBundle {\n  const salt = randomBytes(16).toString(\"hex\");\n  const hash = applyHash(password, salt);\n  return { hash, salt };\n}\n\nexport function verifyPassword(password: string, bundle: PasswordBundle): boolean {\n  return applyHash(password, bundle.salt) === bundle.hash;\n}\n\nfunction applyHash(password: string, salt: string) {\n  return createHash(\"sha256\").update(`${password}:${salt}`).digest(\"hex\");\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAOO,SAAS,aAAa,QAAgB;IAC3C,MAAM,OAAO,IAAA,oHAAW,EAAC,IAAI,QAAQ,CAAC;IACtC,MAAM,OAAO,UAAU,UAAU;IACjC,OAAO;QAAE;QAAM;IAAK;AACtB;AAEO,SAAS,eAAe,QAAgB,EAAE,MAAsB;IACrE,OAAO,UAAU,UAAU,OAAO,IAAI,MAAM,OAAO,IAAI;AACzD;AAEA,SAAS,UAAU,QAAgB,EAAE,IAAY;IAC/C,OAAO,IAAA,mHAAU,EAAC,UAAU,MAAM,CAAC,GAAG,SAAS,CAAC,EAAE,MAAM,EAAE,MAAM,CAAC;AACnE"}},
    {"offset": {"line": 728, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/authOptions.ts"],"sourcesContent":["import CredentialsProvider from \"next-auth/providers/credentials\";\nimport type { NextAuthOptions } from \"next-auth\";\nimport { findUserByEmail } from \"@/lib/repositories\";\nimport { verifyPassword } from \"@/lib/hash\";\n\nexport const authOptions: NextAuthOptions = {\n  providers: [\n    CredentialsProvider({\n      name: \"Credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"email\" },\n        password: { label: \"Senha\", type: \"password\" }\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) return null;\n        const user = await findUserByEmail(credentials.email);\n        if (!user) return null;\n        const isValid = verifyPassword(credentials.password, {\n          hash: user.passwordHash,\n          salt: user.salt\n        });\n        if (!isValid) return null;\n        return { id: user._id ?? \"\", email: user.email };\n      }\n    })\n  ],\n  session: { strategy: \"jwt\" },\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user?.id) {\n        token.id = user.id;\n      }\n      return token;\n    },\n    async session({ session, token }) {\n      if (session.user && token.id) {\n        session.user.id = token.id as string;\n      }\n      return session;\n    }\n  },\n  pages: {\n    signIn: \"/\"\n  },\n  secret: process.env.NEXTAUTH_SECRET\n};\n"],"names":[],"mappings":";;;;AAAA;AAEA;AACA;;;;AAEO,MAAM,cAA+B;IAC1C,WAAW;QACT,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAS,MAAM;gBAAW;YAC/C;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU,OAAO;gBAC1D,MAAM,OAAO,MAAM,IAAA,wIAAe,EAAC,YAAY,KAAK;gBACpD,IAAI,CAAC,MAAM,OAAO;gBAClB,MAAM,UAAU,IAAA,+HAAc,EAAC,YAAY,QAAQ,EAAE;oBACnD,MAAM,KAAK,YAAY;oBACvB,MAAM,KAAK,IAAI;gBACjB;gBACA,IAAI,CAAC,SAAS,OAAO;gBACrB,OAAO;oBAAE,IAAI,KAAK,GAAG,IAAI;oBAAI,OAAO,KAAK,KAAK;gBAAC;YACjD;QACF;KACD;IACD,SAAS;QAAE,UAAU;IAAM;IAC3B,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM,IAAI;gBACZ,MAAM,EAAE,GAAG,KAAK,EAAE;YACpB;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,IAAI,MAAM,EAAE,EAAE;gBAC5B,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;YAC5B;YACA,OAAO;QACT;IACF;IACA,OAAO;QACL,QAAQ;IACV;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;AACrC"}},
    {"offset": {"line": 794, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/authSession.ts"],"sourcesContent":["import { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/authOptions\";\n\nexport async function getOwnerIdFromSession() {\n  const session = await getServerSession(authOptions);\n  return session?.user?.id ?? null;\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM,IAAA,2JAAgB,EAAC,mIAAW;IAClD,OAAO,SAAS,MAAM,MAAM;AAC9B"}},
    {"offset": {"line": 810, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/app/api/auth/logout/route.ts"],"sourcesContent":["import { ok } from \"@/lib/apiResponse\";\nimport { clearPlayerSession } from \"@/lib/repositories\";\nimport { getOwnerIdFromSession } from \"@/lib/authSession\";\n\nexport async function POST() {\n  const ownerId = await getOwnerIdFromSession();\n  if (ownerId) {\n    await clearPlayerSession(ownerId);\n  }\n  return ok({ success: true });\n}\n\nexport async function GET() {\n  return POST();\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM,IAAA,6IAAqB;IAC3C,IAAI,SAAS;QACX,MAAM,IAAA,2IAAkB,EAAC;IAC3B;IACA,OAAO,IAAA,0HAAE,EAAC;QAAE,SAAS;IAAK;AAC5B;AAEO,eAAe;IACpB,OAAO;AACT"}}]
}