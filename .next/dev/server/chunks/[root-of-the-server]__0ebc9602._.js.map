{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/mapStore.ts"],"sourcesContent":["import { promises as fs } from \"node:fs\";\nimport path from \"node:path\";\nimport type { CityMapData, TileMatrix } from \"@/lib/mapTypes\";\n\nconst MAP_FILE = path.join(process.cwd(), \"public\", \"maps\", \"map_city.json\");\nconst TILE_RANGE = { min: 0, max: 1024 };\n\nconst FALLBACK_LAYER: TileMatrix = [\n  [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n];\n\nconst FALLBACK_MAP: CityMapData = {\n  ground: FALLBACK_LAYER,\n  detail: buildEmptyLike(FALLBACK_LAYER),\n  buildings: buildEmptyLike(FALLBACK_LAYER),\n  tints: buildEmptyLike(FALLBACK_LAYER),\n  collision: buildEmptyLike(FALLBACK_LAYER),\n  cover: buildEmptyLike(FALLBACK_LAYER)\n};\n\nexport async function readCityMap(): Promise<CityMapData> {\n  try {\n    const buffer = await fs.readFile(MAP_FILE, \"utf-8\");\n    const parsed = JSON.parse(buffer);\n    const normalized = normalizeCityMap(parsed);\n    if (normalized) return normalized;\n  } catch (err) {\n    // ignored, fallback below\n  }\n  await saveCityMap(FALLBACK_MAP);\n  return FALLBACK_MAP;\n}\n\nexport async function saveCityMap(map: CityMapData) {\n  const normalized = normalizeCityMap(map);\n  if (!normalized) {\n    throw new Error(\"Mapa inválido. Use apenas números inteiros em todas as camadas.\");\n  }\n  await fs.mkdir(path.dirname(MAP_FILE), { recursive: true });\n  await fs.writeFile(MAP_FILE, JSON.stringify(normalized));\n  return normalized;\n}\n\nfunction normalizeCityMap(value: unknown): CityMapData | null {\n  if (!value || typeof value !== \"object\") return null;\n  const candidate = value as Partial<CityMapData>;\n  if (!isValidMatrix(candidate.ground)) return null;\n  const width = candidate.ground[0]?.length ?? 0;\n  const height = candidate.ground.length;\n  if (!width || !height) return null;\n  return {\n    ground: normalizeLayer(candidate.ground, width, height),\n    detail: normalizeLayer(candidate.detail, width, height),\n    buildings: normalizeLayer(candidate.buildings, width, height),\n    tints: normalizeLayer(candidate.tints, width, height),\n    collision: normalizeLayer(candidate.collision, width, height),\n    cover: normalizeLayer(candidate.cover, width, height)\n  };\n}\n\nfunction normalizeLayer(layer: TileMatrix | undefined, width: number, height: number): TileMatrix {\n  if (isValidMatrix(layer, width, height)) {\n    return layer as TileMatrix;\n  }\n  return Array.from({ length: height }, () => Array.from({ length: width }, () => 0));\n}\n\nfunction isValidMatrix(value: unknown, width?: number, height?: number): value is TileMatrix {\n  if (!Array.isArray(value) || value.length === 0) return false;\n  if (height && value.length !== height) return false;\n  return value.every((row) => {\n    if (!Array.isArray(row) || row.length === 0) return false;\n    if (width && row.length !== width) return false;\n    return row.every(\n      (cell) => Number.isInteger(cell) && cell >= TILE_RANGE.min && cell <= TILE_RANGE.max\n    );\n  });\n}\n\nfunction buildEmptyLike(layer: TileMatrix): TileMatrix {\n  return layer.map((row) => row.map(() => 0));\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAGA,MAAM,WAAW,4HAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,QAAQ;AAC5D,MAAM,aAAa;IAAE,KAAK;IAAG,KAAK;AAAK;AAEvC,MAAM,iBAA6B;IACjC;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;QAAC;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;QAAG;KAAE;IAC3H;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"}},
    {"offset": {"line": 1045, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/api/city/service.ts"],"sourcesContent":["import { readCityMap, saveCityMap } from \"@/lib/mapStore\";\nimport type { CityMapData } from \"@/lib/mapTypes\";\n\nexport async function loadCityMap() {\n  return readCityMap();\n}\n\nexport async function persistCityMap(map: CityMapData) {\n  return saveCityMap(map);\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAGO,eAAe;IACpB,OAAO,IAAA,gIAAW;AACpB;AAEO,eAAe,eAAe,GAAgB;IACnD,OAAO,IAAA,gIAAW,EAAC;AACrB"}},
    {"offset": {"line": 1069, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/apiResponse.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\nexport function ok<T>(data: T, status = 200) {\n  return NextResponse.json(data, { status });\n}\n\nexport function error(message: string, status = 400) {\n  return NextResponse.json({ error: message }, { status });\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,SAAS,GAAM,IAAO,EAAE,SAAS,GAAG;IACzC,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM;QAAE;IAAO;AAC1C;AAEO,SAAS,MAAM,OAAe,EAAE,SAAS,GAAG;IACjD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAQ,GAAG;QAAE;IAAO;AACxD"}},
    {"offset": {"line": 1093, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/app/api/city/map/route.ts"],"sourcesContent":["import { persistCityMap, loadCityMap } from \"@/api/city/service\";\nimport { error, ok } from \"@/lib/apiResponse\";\nimport { z } from \"zod\";\n\nconst layerSchema = z.array(z.array(z.number().int().min(0).max(50)));\nconst mapSchema = z.object({\n  ground: layerSchema,\n  detail: layerSchema,\n  buildings: layerSchema,\n  tints: layerSchema,\n  collision: layerSchema,\n  cover: layerSchema\n});\n\nexport async function GET() {\n  const map = await loadCityMap();\n  return ok({ map });\n}\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const parsed = mapSchema.parse(body.map ?? body);\n    const map = await persistCityMap(parsed);\n    return ok({ map });\n  } catch (err) {\n    return error(getMessage(err), 400);\n  }\n}\n\nfunction getMessage(err: unknown) {\n  return err instanceof Error ? err.message : \"Mapa inválido\";\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,cAAc,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;AAChE,MAAM,YAAY,oLAAC,CAAC,MAAM,CAAC;IACzB,QAAQ;IACR,QAAQ;IACR,WAAW;IACX,OAAO;IACP,WAAW;IACX,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,MAAM,MAAM,IAAA,uIAAW;IAC7B,OAAO,IAAA,0HAAE,EAAC;QAAE;IAAI;AAClB;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,SAAS,UAAU,KAAK,CAAC,KAAK,GAAG,IAAI;QAC3C,MAAM,MAAM,MAAM,IAAA,0IAAc,EAAC;QACjC,OAAO,IAAA,0HAAE,EAAC;YAAE;QAAI;IAClB,EAAE,OAAO,KAAK;QACZ,OAAO,IAAA,6HAAK,EAAC,WAAW,MAAM;IAChC;AACF;AAEA,SAAS,WAAW,GAAY;IAC9B,OAAO,eAAe,QAAQ,IAAI,OAAO,GAAG;AAC9C"}}]
}