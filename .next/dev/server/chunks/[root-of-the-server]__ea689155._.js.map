{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/hash.ts"],"sourcesContent":["import { createHash, randomBytes } from \"crypto\";\n\nexport type PasswordBundle = {\n  hash: string;\n  salt: string;\n};\n\nexport function hashPassword(password: string): PasswordBundle {\n  const salt = randomBytes(16).toString(\"hex\");\n  const hash = applyHash(password, salt);\n  return { hash, salt };\n}\n\nexport function verifyPassword(password: string, bundle: PasswordBundle): boolean {\n  return applyHash(password, bundle.salt) === bundle.hash;\n}\n\nfunction applyHash(password: string, salt: string) {\n  return createHash(\"sha256\").update(`${password}:${salt}`).digest(\"hex\");\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAOO,SAAS,aAAa,QAAgB;IAC3C,MAAM,OAAO,IAAA,oHAAW,EAAC,IAAI,QAAQ,CAAC;IACtC,MAAM,OAAO,UAAU,UAAU;IACjC,OAAO;QAAE;QAAM;IAAK;AACtB;AAEO,SAAS,eAAe,QAAgB,EAAE,MAAsB;IACrE,OAAO,UAAU,UAAU,OAAO,IAAI,MAAM,OAAO,IAAI;AACzD;AAEA,SAAS,UAAU,QAAgB,EAAE,IAAY;IAC/C,OAAO,IAAA,mHAAU,EAAC,UAAU,MAAM,CAAC,GAAG,SAAS,CAAC,EAAE,MAAM,EAAE,MAAM,CAAC;AACnE"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/models.ts"],"sourcesContent":["import { z } from \"zod\";\n\nexport type InventoryItem = {\n  id: string;\n  name: string;\n  quantity: number;\n};\n\nexport type User = {\n  _id?: string;\n  email: string;\n  passwordHash: string;\n  salt: string;\n  createdAt: string;\n};\n\nexport type CharacterStats = {\n  level: number;\n  xp: number;\n  hp: number;\n  energy: number;\n};\n\nexport type Character = {\n  _id?: string;\n  ownerId: string;\n  name: string;\n  sprite: string;\n  inventory: InventoryItem[];\n  stats: CharacterStats;\n  createdAt: string;\n  updatedAt: string;\n};\n\nexport type HouseFurniture = {\n  id: string;\n  name: string;\n  position: { x: number; y: number };\n};\n\nexport type HouseState = {\n  ownerId: string;\n  furniture: HouseFurniture[];\n};\n\nexport type FarmPlot = {\n  id: string;\n  seed: string | null;\n  plantedAt: string | null;\n  harvestReadyAt: string | null;\n};\n\nexport type FarmState = {\n  ownerId: string;\n  plots: FarmPlot[];\n};\n\nexport type ChatMessage = {\n  id: string;\n  ownerId: string;\n  characterName?: string;\n  message: string;\n  createdAt: string;\n};\n\nexport type OnlinePresence = {\n  ownerId: string;\n  lastPing: string;\n};\n\nexport type PlayerSessionState = {\n  ownerId: string;\n  characterId: string;\n  map: string;\n  position: { x: number; y: number };\n  updatedAt: string;\n};\n\nexport type QuickSlotLayout = {\n  ownerId: string;\n  slots: Array<string | null>;\n  updatedAt: string;\n};\n\nexport const registerSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6)\n});\n\nexport const loginSchema = registerSchema;\n\nexport const characterCreateSchema = z.object({\n  ownerId: z.string().min(1),\n  name: z.string().min(3).max(20),\n  sprite: z.string().min(1)\n});\n\nexport const onlinePingSchema = z.object({\n  ownerId: z.string().min(1)\n});\n\nexport const inventoryItemSchema = z.object({\n  id: z.string().min(1),\n  name: z.string().min(1),\n  quantity: z.number().int().min(1)\n});\n\nexport const inventoryAddSchema = z.object({\n  ownerId: z.string().min(1),\n  item: inventoryItemSchema\n});\n\nexport const inventoryRemoveSchema = z.object({\n  ownerId: z.string().min(1),\n  itemId: z.string().min(1),\n  quantity: z.number().int().min(1)\n});\n\nexport const chatSendSchema = z.object({\n  ownerId: z.string().min(1),\n  name: z.string().min(1).max(20).optional(),\n  message: z.string().min(1).max(280)\n});\n\nexport const houseUpdateSchema = z.object({\n  ownerId: z.string().min(1),\n  furniture: z\n    .array(\n      z.object({\n        id: z.string().min(1),\n        name: z.string().min(1),\n        position: z.object({\n          x: z.number().min(0),\n          y: z.number().min(0)\n        })\n      })\n    )\n    .max(4)\n});\n\nexport const farmPlantSchema = z.object({\n  ownerId: z.string().min(1),\n  plotId: z.string().min(1),\n  seed: z.string().min(1)\n});\n\nexport const farmHarvestSchema = z.object({\n  ownerId: z.string().min(1),\n  plotId: z.string().min(1)\n});\n\nexport const forestKillSchema = z.object({\n  ownerId: z.string().min(1)\n});\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAoFO,MAAM,iBAAiB,oLAAC,CAAC,MAAM,CAAC;IACrC,OAAO,oLAAC,CAAC,MAAM,GAAG,KAAK;IACvB,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC3B;AAEO,MAAM,cAAc;AAEpB,MAAM,wBAAwB,oLAAC,CAAC,MAAM,CAAC;IAC5C,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;IAC5B,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AACzB;AAEO,MAAM,mBAAmB,oLAAC,CAAC,MAAM,CAAC;IACvC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC1B;AAEO,MAAM,sBAAsB,oLAAC,CAAC,MAAM,CAAC;IAC1C,IAAI,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACnB,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACrB,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC;AACjC;AAEO,MAAM,qBAAqB,oLAAC,CAAC,MAAM,CAAC;IACzC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,MAAM;AACR;AAEO,MAAM,wBAAwB,oLAAC,CAAC,MAAM,CAAC;IAC5C,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACvB,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC;AACjC;AAEO,MAAM,iBAAiB,oLAAC,CAAC,MAAM,CAAC;IACrC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,IAAI,QAAQ;IACxC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;AACjC;AAEO,MAAM,oBAAoB,oLAAC,CAAC,MAAM,CAAC;IACxC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,WAAW,oLAAC,CACT,KAAK,CACJ,oLAAC,CAAC,MAAM,CAAC;QACP,IAAI,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACnB,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACrB,UAAU,oLAAC,CAAC,MAAM,CAAC;YACjB,GAAG,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;YAClB,GAAG,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACpB;IACF,IAED,GAAG,CAAC;AACT;AAEO,MAAM,kBAAkB,oLAAC,CAAC,MAAM,CAAC;IACtC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACvB,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AACvB;AAEO,MAAM,oBAAoB,oLAAC,CAAC,MAAM,CAAC;IACxC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AACzB;AAEO,MAAM,mBAAmB,oLAAC,CAAC,MAAM,CAAC;IACvC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC1B"}},
    {"offset": {"line": 165, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/db.ts"],"sourcesContent":["import { MongoClient, Collection, type Document } from \"mongodb\";\n\nlet client: MongoClient | null = null;\n\nconst uri = process.env.MONGODB_URI;\nconst parsedDbName = (() => {\n  if (!uri) return null;\n  try {\n    const url = new URL(uri);\n    const pathname = url.pathname.replace(/^\\//, \"\");\n    return pathname || null;\n  } catch {\n    return null;\n  }\n})();\n\nasync function getClient() {\n  if (!uri) {\n    throw new Error(\"MONGODB_URI não configurado\");\n  }\n\n  if (!client) {\n    client = new MongoClient(uri);\n    await client.connect();\n  }\n\n  return client;\n}\n\nexport async function getCollection<T extends Document = Document>(\n  name: string\n): Promise<Collection<T>> {\n  const cli = await getClient();\n  const dbName = process.env.MONGODB_DB || parsedDbName || \"simpleapp\";\n  return cli.db(dbName).collection<T>(name);\n}\n\nexport function hasMongoConnection() {\n  return Boolean(uri);\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,SAA6B;AAEjC,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,eAAe,CAAC;IACpB,IAAI,CAAC,KAAK,OAAO;IACjB,IAAI;QACF,MAAM,MAAM,IAAI,IAAI;QACpB,MAAM,WAAW,IAAI,QAAQ,CAAC,OAAO,CAAC,OAAO;QAC7C,OAAO,YAAY;IACrB,EAAE,OAAM;QACN,OAAO;IACT;AACF,CAAC;AAED,eAAe;IACb,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,CAAC,QAAQ;QACX,SAAS,IAAI,sHAAW,CAAC;QACzB,MAAM,OAAO,OAAO;IACtB;IAEA,OAAO;AACT;AAEO,eAAe,cACpB,IAAY;IAEZ,MAAM,MAAM,MAAM;IAClB,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI,gBAAgB;IACzD,OAAO,IAAI,EAAE,CAAC,QAAQ,UAAU,CAAI;AACtC;AAEO,SAAS;IACd,OAAO,QAAQ;AACjB"}},
    {"offset": {"line": 207, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/memoryStore.ts"],"sourcesContent":["import type {\n  ChatMessage,\n  Character,\n  FarmState,\n  HouseState,\n  InventoryItem,\n  OnlinePresence,\n  PlayerSessionState,\n  QuickSlotLayout,\n  User\n} from \"./models\";\n\ntype MemoryDB = {\n  users: User[];\n  characters: Character[];\n  inventory: Record<string, InventoryItem[]>;\n  houses: HouseState[];\n  farms: FarmState[];\n  chat: ChatMessage[];\n  online: OnlinePresence[];\n  sessions: PlayerSessionState[];\n  quickSlots: QuickSlotLayout[];\n};\n\nconst memoryDb: MemoryDB = {\n  users: [],\n  characters: [],\n  inventory: {},\n  houses: [],\n  farms: [],\n  chat: [],\n  online: [],\n  sessions: [],\n  quickSlots: []\n};\n\nexport function getMemoryDB() {\n  return memoryDb;\n}\n"],"names":[],"mappings":";;;;AAwBA,MAAM,WAAqB;IACzB,OAAO,EAAE;IACT,YAAY,EAAE;IACd,WAAW,CAAC;IACZ,QAAQ,EAAE;IACV,OAAO,EAAE;IACT,MAAM,EAAE;IACR,QAAQ,EAAE;IACV,UAAU,EAAE;IACZ,YAAY,EAAE;AAChB;AAEO,SAAS;IACd,OAAO;AACT"}},
    {"offset": {"line": 229, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/repositories.ts"],"sourcesContent":["import { ObjectId, type OptionalUnlessRequiredId } from \"mongodb\";\nimport { getCollection, hasMongoConnection } from \"./db\";\nimport { getMemoryDB } from \"./memoryStore\";\nimport type {\n  ChatMessage,\n  Character,\n  FarmState,\n  HouseState,\n  InventoryItem,\n  OnlinePresence,\n  PlayerSessionState,\n  QuickSlotLayout,\n  User\n} from \"./models\";\n\ntype CharacterDocument = Omit<Character, \"_id\"> & { _id: ObjectId };\ntype UserDocument = Omit<User, \"_id\"> & { _id: ObjectId };\n\nexport async function findUserByEmail(email: string) {\n  if (hasMongoConnection()) {\n    const users = await getCollection<UserDocument>(\"users\");\n    const doc = await users.findOne({ email });\n    return doc ? normalizeUser(doc) : null;\n  }\n\n  const memory = getMemoryDB();\n  return memory.users.find((user) => user.email === email) ?? null;\n}\n\nexport async function insertUser(user: User) {\n  if (hasMongoConnection()) {\n    const users = await getCollection<UserDocument>(\"users\");\n    const { _id, ...doc } = user;\n    const result = await users.insertOne(doc as OptionalUnlessRequiredId<UserDocument>);\n    return { ...doc, _id: String(result.insertedId) };\n  }\n\n  const memory = getMemoryDB();\n  const stored = { ...user, _id: new ObjectId().toHexString() };\n  memory.users.push(stored);\n  return stored;\n}\n\nexport async function countCharacters(ownerId: string) {\n  if (hasMongoConnection()) {\n    const characters = await getCollection<CharacterDocument>(\"characters\");\n    return characters.countDocuments({ ownerId });\n  }\n\n  const memory = getMemoryDB();\n  return memory.characters.filter((c) => c.ownerId === ownerId).length;\n}\n\nexport async function insertCharacter(character: Character) {\n  if (hasMongoConnection()) {\n    const characters = await getCollection<CharacterDocument>(\"characters\");\n    const { _id, ...doc } = character;\n    const result = await characters.insertOne(\n      doc as OptionalUnlessRequiredId<CharacterDocument>\n    );\n    return { ...doc, _id: String(result.insertedId) };\n  }\n\n  const memory = getMemoryDB();\n  const stored = { ...character, _id: new ObjectId().toHexString() };\n  memory.characters.push(stored);\n  return stored;\n}\n\nexport async function listCharacters(ownerId: string) {\n  if (hasMongoConnection()) {\n    const characters = await getCollection<CharacterDocument>(\"characters\");\n    const docs = await characters\n      .find({ ownerId })\n      .sort({ createdAt: 1 })\n      .limit(4)\n      .toArray();\n    return docs.map((doc) => normalizeCharacter(doc));\n  }\n\n  const memory = getMemoryDB();\n  return memory.characters.filter((c) => c.ownerId === ownerId).map((c) => ({ ...c }));\n}\n\nexport async function findCharacterById(ownerId: string, characterId: string) {\n  if (hasMongoConnection()) {\n    if (!ObjectId.isValid(characterId)) {\n      return null;\n    }\n    const characters = await getCollection<CharacterDocument>(\"characters\");\n    const doc = await characters.findOne({ ownerId, _id: new ObjectId(characterId) });\n    return doc ? normalizeCharacter(doc) : null;\n  }\n\n  const memory = getMemoryDB();\n  const character = memory.characters.find(\n    (c) => c.ownerId === ownerId && c._id === characterId\n  );\n  return character ? { ...character } : null;\n}\n\nexport async function getInventory(ownerId: string) {\n  if (hasMongoConnection()) {\n    const inventory = await getCollection<{ ownerId: string; items: InventoryItem[] }>(\"inventory\");\n    const doc = await inventory.findOne({ ownerId });\n    return doc?.items ?? [];\n  }\n\n  const memory = getMemoryDB();\n  const items = memory.inventory[ownerId] ?? [];\n  memory.inventory[ownerId] = items;\n  return items;\n}\n\nexport async function saveInventory(ownerId: string, items: InventoryItem[]) {\n  if (hasMongoConnection()) {\n    const inventory = await getCollection<{ ownerId: string; items: InventoryItem[] }>(\"inventory\");\n    await inventory.updateOne(\n      { ownerId },\n      { $set: { ownerId, items } },\n      { upsert: true }\n    );\n    return items;\n  }\n\n  const memory = getMemoryDB();\n  memory.inventory[ownerId] = items;\n  return items;\n}\n\nexport async function getHouse(ownerId: string): Promise<HouseState> {\n  if (hasMongoConnection()) {\n    const houses = await getCollection<HouseState>(\"houses\");\n    const doc = await houses.findOne({ ownerId });\n    return (\n      doc ?? {\n        ownerId,\n        furniture: defaultFurniture()\n      }\n    );\n  }\n\n  const memory = getMemoryDB();\n  let house = memory.houses.find((h) => h.ownerId === ownerId);\n  if (!house) {\n    house = { ownerId, furniture: defaultFurniture() };\n    memory.houses.push(house);\n  }\n  return house;\n}\n\nexport async function updateHouse(ownerId: string, furniture: HouseState[\"furniture\"]) {\n  const state = { ownerId, furniture };\n  if (hasMongoConnection()) {\n    const houses = await getCollection<HouseState>(\"houses\");\n    await houses.updateOne({ ownerId }, { $set: state }, { upsert: true });\n    return state;\n  }\n\n  const memory = getMemoryDB();\n  const index = memory.houses.findIndex((h) => h.ownerId === ownerId);\n  if (index >= 0) {\n    memory.houses[index] = state;\n    return state;\n  }\n  memory.houses.push(state);\n  return state;\n}\n\nexport async function getFarm(ownerId: string): Promise<FarmState> {\n  if (hasMongoConnection()) {\n    const farms = await getCollection<FarmState>(\"farms\");\n    const doc = await farms.findOne({ ownerId });\n    return doc ?? { ownerId, plots: defaultFarmPlots() };\n  }\n\n  const memory = getMemoryDB();\n  let farm = memory.farms.find((f) => f.ownerId === ownerId);\n  if (!farm) {\n    farm = { ownerId, plots: defaultFarmPlots() };\n    memory.farms.push(farm);\n  }\n  return farm;\n}\n\nexport async function saveFarm(state: FarmState) {\n  if (hasMongoConnection()) {\n    const farms = await getCollection<FarmState>(\"farms\");\n    await farms.updateOne({ ownerId: state.ownerId }, { $set: state }, { upsert: true });\n    return state;\n  }\n\n  const memory = getMemoryDB();\n  const index = memory.farms.findIndex((f) => f.ownerId === state.ownerId);\n  if (index >= 0) {\n    memory.farms[index] = state;\n    return state;\n  }\n  memory.farms.push(state);\n  return state;\n}\n\nexport async function getPlayerSession(ownerId: string) {\n  if (hasMongoConnection()) {\n    const sessions = await getCollection<PlayerSessionState>(\"sessions\");\n    return sessions.findOne({ ownerId });\n  }\n\n  const memory = getMemoryDB();\n  return memory.sessions.find((session) => session.ownerId === ownerId) ?? null;\n}\n\nexport async function savePlayerSession(state: PlayerSessionState) {\n  const payload = { ...state, updatedAt: new Date().toISOString() };\n  if (hasMongoConnection()) {\n    const sessions = await getCollection<PlayerSessionState>(\"sessions\");\n    await sessions.updateOne({ ownerId: state.ownerId }, { $set: payload }, { upsert: true });\n    return payload;\n  }\n\n  const memory = getMemoryDB();\n  const index = memory.sessions.findIndex((session) => session.ownerId === state.ownerId);\n  if (index >= 0) {\n    memory.sessions[index] = payload;\n  } else {\n    memory.sessions.push(payload);\n  }\n  return payload;\n}\n\nexport async function clearPlayerSession(ownerId: string) {\n  if (hasMongoConnection()) {\n    const sessions = await getCollection<PlayerSessionState>(\"sessions\");\n    await sessions.deleteOne({ ownerId });\n    return;\n  }\n\n  const memory = getMemoryDB();\n  memory.sessions = memory.sessions.filter((session) => session.ownerId !== ownerId);\n}\n\nexport async function getQuickSlots(ownerId: string) {\n  if (hasMongoConnection()) {\n    const layout = await getCollection<QuickSlotLayout>(\"quickslots\");\n    const doc = await layout.findOne({ ownerId });\n    return doc?.slots ?? defaultQuickSlots();\n  }\n\n  const memory = getMemoryDB();\n  const existing = memory.quickSlots.find((slot) => slot.ownerId === ownerId);\n  if (!existing) {\n    const created = { ownerId, slots: defaultQuickSlots(), updatedAt: new Date().toISOString() };\n    memory.quickSlots.push(created);\n    return created.slots;\n  }\n  return existing.slots;\n}\n\nexport async function saveQuickSlots(ownerId: string, slots: Array<string | null>) {\n  const payload: QuickSlotLayout = {\n    ownerId,\n    slots,\n    updatedAt: new Date().toISOString()\n  };\n  if (hasMongoConnection()) {\n    const layout = await getCollection<QuickSlotLayout>(\"quickslots\");\n    await layout.updateOne({ ownerId }, { $set: payload }, { upsert: true });\n    return payload.slots;\n  }\n\n  const memory = getMemoryDB();\n  const index = memory.quickSlots.findIndex((slot) => slot.ownerId === ownerId);\n  if (index >= 0) {\n    memory.quickSlots[index] = payload;\n  } else {\n    memory.quickSlots.push(payload);\n  }\n  return payload.slots;\n}\n\nexport async function addChatMessage(message: ChatMessage) {\n  if (hasMongoConnection()) {\n    const chat = await getCollection<ChatMessage>(\"chat\");\n    await chat.insertOne(message);\n    return message;\n  }\n\n  const memory = getMemoryDB();\n  memory.chat.push(message);\n  memory.chat = memory.chat.slice(-50);\n  return message;\n}\n\nexport async function listChatMessages(limit = 20) {\n  if (hasMongoConnection()) {\n    const chat = await getCollection<ChatMessage>(\"chat\");\n    const docs = await chat.find({}, { sort: { createdAt: -1 } }).limit(limit).toArray();\n    return docs.reverse();\n  }\n\n  const memory = getMemoryDB();\n  return memory.chat.slice(-limit);\n}\n\nexport async function pingOnline(ownerId: string) {\n  const entry: OnlinePresence = { ownerId, lastPing: new Date().toISOString() };\n  if (hasMongoConnection()) {\n    const online = await getCollection<OnlinePresence>(\"online\");\n    await online.updateOne({ ownerId }, { $set: entry }, { upsert: true });\n    return entry;\n  }\n\n  const memory = getMemoryDB();\n  const index = memory.online.findIndex((o) => o.ownerId === ownerId);\n  if (index >= 0) {\n    memory.online[index] = entry;\n  } else {\n    memory.online.push(entry);\n  }\n  return entry;\n}\n\nexport async function listOnline() {\n  const cutoff = Date.now() - 1000 * 60;\n  if (hasMongoConnection()) {\n    const online = await getCollection<OnlinePresence>(\"online\");\n    const docs = await online\n      .find({ lastPing: { $gte: new Date(cutoff).toISOString() } })\n      .toArray();\n    return docs;\n  }\n\n  const memory = getMemoryDB();\n  return memory.online.filter((o) => new Date(o.lastPing).getTime() >= cutoff);\n}\n\nfunction normalizeCharacter(\n  doc: CharacterDocument | (Character & { _id?: any })\n): Character {\n  const normalizedId =\n    typeof doc._id === \"string\" ? doc._id : doc._id?.toString?.();\n  return {\n    ...(structuredCloneCharacter(doc)),\n    _id: normalizedId\n  };\n}\n\nfunction normalizeUser(doc: UserDocument): User {\n  const normalizedId =\n    typeof doc._id === \"string\" ? doc._id : doc._id?.toString?.();\n  return {\n    ...(structuredCloneUser(doc)),\n    _id: normalizedId\n  };\n}\n\nfunction structuredCloneCharacter(\n  doc: CharacterDocument | (Character & { _id?: any })\n): Character {\n  const { _id, ...rest } = doc as Character;\n  return { ...rest };\n}\n\nfunction structuredCloneUser(doc: UserDocument | (User & { _id?: any })): User {\n  const { _id, ...rest } = doc as User;\n  return { ...rest };\n}\n\nfunction defaultFurniture() {\n  return [\n    { id: \"bed\", name: \"Cama Simples\", position: { x: 64, y: 32 } },\n    { id: \"table\", name: \"Mesa Madeira\", position: { x: 32, y: 96 } },\n    { id: \"shelf\", name: \"Estante Pequena\", position: { x: 96, y: 32 } },\n    { id: \"lamp\", name: \"Lamparina\", position: { x: 128, y: 96 } }\n  ];\n}\n\nfunction defaultQuickSlots(): Array<string | null> {\n  return [null, null, null, null];\n}\n\nfunction defaultFarmPlots() {\n  return Array.from({ length: 4 }).map((_, index) => ({\n    id: `plot-${index + 1}`,\n    seed: null,\n    plantedAt: null,\n    harvestReadyAt: null\n  }));\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;;;;AAgBO,eAAe,gBAAgB,KAAa;IACjD,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,QAAQ,MAAM,IAAA,4HAAa,EAAe;QAChD,MAAM,MAAM,MAAM,MAAM,OAAO,CAAC;YAAE;QAAM;QACxC,OAAO,MAAM,cAAc,OAAO;IACpC;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,OAAO,OAAO,KAAK,CAAC,IAAI,CAAC,CAAC,OAAS,KAAK,KAAK,KAAK,UAAU;AAC9D;AAEO,eAAe,WAAW,IAAU;IACzC,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,QAAQ,MAAM,IAAA,4HAAa,EAAe;QAChD,MAAM,EAAE,GAAG,EAAE,GAAG,KAAK,GAAG;QACxB,MAAM,SAAS,MAAM,MAAM,SAAS,CAAC;QACrC,OAAO;YAAE,GAAG,GAAG;YAAE,KAAK,OAAO,OAAO,UAAU;QAAE;IAClD;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,MAAM,SAAS;QAAE,GAAG,IAAI;QAAE,KAAK,IAAI,mHAAQ,GAAG,WAAW;IAAG;IAC5D,OAAO,KAAK,CAAC,IAAI,CAAC;IAClB,OAAO;AACT;AAEO,eAAe,gBAAgB,OAAe;IACnD,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,aAAa,MAAM,IAAA,4HAAa,EAAoB;QAC1D,OAAO,WAAW,cAAc,CAAC;YAAE;QAAQ;IAC7C;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,OAAO,OAAO,UAAU,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,OAAO,KAAK,SAAS,MAAM;AACtE;AAEO,eAAe,gBAAgB,SAAoB;IACxD,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,aAAa,MAAM,IAAA,4HAAa,EAAoB;QAC1D,MAAM,EAAE,GAAG,EAAE,GAAG,KAAK,GAAG;QACxB,MAAM,SAAS,MAAM,WAAW,SAAS,CACvC;QAEF,OAAO;YAAE,GAAG,GAAG;YAAE,KAAK,OAAO,OAAO,UAAU;QAAE;IAClD;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,MAAM,SAAS;QAAE,GAAG,SAAS;QAAE,KAAK,IAAI,mHAAQ,GAAG,WAAW;IAAG;IACjE,OAAO,UAAU,CAAC,IAAI,CAAC;IACvB,OAAO;AACT;AAEO,eAAe,eAAe,OAAe;IAClD,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,aAAa,MAAM,IAAA,4HAAa,EAAoB;QAC1D,MAAM,OAAO,MAAM,WAChB,IAAI,CAAC;YAAE;QAAQ,GACf,IAAI,CAAC;YAAE,WAAW;QAAE,GACpB,KAAK,CAAC,GACN,OAAO;QACV,OAAO,KAAK,GAAG,CAAC,CAAC,MAAQ,mBAAmB;IAC9C;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,OAAO,OAAO,UAAU,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,OAAO,KAAK,SAAS,GAAG,CAAC,CAAC,IAAM,CAAC;YAAE,GAAG,CAAC;QAAC,CAAC;AACpF;AAEO,eAAe,kBAAkB,OAAe,EAAE,WAAmB;IAC1E,IAAI,IAAA,iIAAkB,KAAI;QACxB,IAAI,CAAC,mHAAQ,CAAC,OAAO,CAAC,cAAc;YAClC,OAAO;QACT;QACA,MAAM,aAAa,MAAM,IAAA,4HAAa,EAAoB;QAC1D,MAAM,MAAM,MAAM,WAAW,OAAO,CAAC;YAAE;YAAS,KAAK,IAAI,mHAAQ,CAAC;QAAa;QAC/E,OAAO,MAAM,mBAAmB,OAAO;IACzC;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,MAAM,YAAY,OAAO,UAAU,CAAC,IAAI,CACtC,CAAC,IAAM,EAAE,OAAO,KAAK,WAAW,EAAE,GAAG,KAAK;IAE5C,OAAO,YAAY;QAAE,GAAG,SAAS;IAAC,IAAI;AACxC;AAEO,eAAe,aAAa,OAAe;IAChD,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,YAAY,MAAM,IAAA,4HAAa,EAA8C;QACnF,MAAM,MAAM,MAAM,UAAU,OAAO,CAAC;YAAE;QAAQ;QAC9C,OAAO,KAAK,SAAS,EAAE;IACzB;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,MAAM,QAAQ,OAAO,SAAS,CAAC,QAAQ,IAAI,EAAE;IAC7C,OAAO,SAAS,CAAC,QAAQ,GAAG;IAC5B,OAAO;AACT;AAEO,eAAe,cAAc,OAAe,EAAE,KAAsB;IACzE,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,YAAY,MAAM,IAAA,4HAAa,EAA8C;QACnF,MAAM,UAAU,SAAS,CACvB;YAAE;QAAQ,GACV;YAAE,MAAM;gBAAE;gBAAS;YAAM;QAAE,GAC3B;YAAE,QAAQ;QAAK;QAEjB,OAAO;IACT;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,OAAO,SAAS,CAAC,QAAQ,GAAG;IAC5B,OAAO;AACT;AAEO,eAAe,SAAS,OAAe;IAC5C,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,SAAS,MAAM,IAAA,4HAAa,EAAa;QAC/C,MAAM,MAAM,MAAM,OAAO,OAAO,CAAC;YAAE;QAAQ;QAC3C,OACE,OAAO;YACL;YACA,WAAW;QACb;IAEJ;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,IAAI,QAAQ,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,OAAO,KAAK;IACpD,IAAI,CAAC,OAAO;QACV,QAAQ;YAAE;YAAS,WAAW;QAAmB;QACjD,OAAO,MAAM,CAAC,IAAI,CAAC;IACrB;IACA,OAAO;AACT;AAEO,eAAe,YAAY,OAAe,EAAE,SAAkC;IACnF,MAAM,QAAQ;QAAE;QAAS;IAAU;IACnC,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,SAAS,MAAM,IAAA,4HAAa,EAAa;QAC/C,MAAM,OAAO,SAAS,CAAC;YAAE;QAAQ,GAAG;YAAE,MAAM;QAAM,GAAG;YAAE,QAAQ;QAAK;QACpE,OAAO;IACT;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,MAAM,QAAQ,OAAO,MAAM,CAAC,SAAS,CAAC,CAAC,IAAM,EAAE,OAAO,KAAK;IAC3D,IAAI,SAAS,GAAG;QACd,OAAO,MAAM,CAAC,MAAM,GAAG;QACvB,OAAO;IACT;IACA,OAAO,MAAM,CAAC,IAAI,CAAC;IACnB,OAAO;AACT;AAEO,eAAe,QAAQ,OAAe;IAC3C,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,QAAQ,MAAM,IAAA,4HAAa,EAAY;QAC7C,MAAM,MAAM,MAAM,MAAM,OAAO,CAAC;YAAE;QAAQ;QAC1C,OAAO,OAAO;YAAE;YAAS,OAAO;QAAmB;IACrD;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,IAAI,OAAO,OAAO,KAAK,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,OAAO,KAAK;IAClD,IAAI,CAAC,MAAM;QACT,OAAO;YAAE;YAAS,OAAO;QAAmB;QAC5C,OAAO,KAAK,CAAC,IAAI,CAAC;IACpB;IACA,OAAO;AACT;AAEO,eAAe,SAAS,KAAgB;IAC7C,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,QAAQ,MAAM,IAAA,4HAAa,EAAY;QAC7C,MAAM,MAAM,SAAS,CAAC;YAAE,SAAS,MAAM,OAAO;QAAC,GAAG;YAAE,MAAM;QAAM,GAAG;YAAE,QAAQ;QAAK;QAClF,OAAO;IACT;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,MAAM,QAAQ,OAAO,KAAK,CAAC,SAAS,CAAC,CAAC,IAAM,EAAE,OAAO,KAAK,MAAM,OAAO;IACvE,IAAI,SAAS,GAAG;QACd,OAAO,KAAK,CAAC,MAAM,GAAG;QACtB,OAAO;IACT;IACA,OAAO,KAAK,CAAC,IAAI,CAAC;IAClB,OAAO;AACT;AAEO,eAAe,iBAAiB,OAAe;IACpD,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,WAAW,MAAM,IAAA,4HAAa,EAAqB;QACzD,OAAO,SAAS,OAAO,CAAC;YAAE;QAAQ;IACpC;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,OAAO,OAAO,QAAQ,CAAC,IAAI,CAAC,CAAC,UAAY,QAAQ,OAAO,KAAK,YAAY;AAC3E;AAEO,eAAe,kBAAkB,KAAyB;IAC/D,MAAM,UAAU;QAAE,GAAG,KAAK;QAAE,WAAW,IAAI,OAAO,WAAW;IAAG;IAChE,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,WAAW,MAAM,IAAA,4HAAa,EAAqB;QACzD,MAAM,SAAS,SAAS,CAAC;YAAE,SAAS,MAAM,OAAO;QAAC,GAAG;YAAE,MAAM;QAAQ,GAAG;YAAE,QAAQ;QAAK;QACvF,OAAO;IACT;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,MAAM,QAAQ,OAAO,QAAQ,CAAC,SAAS,CAAC,CAAC,UAAY,QAAQ,OAAO,KAAK,MAAM,OAAO;IACtF,IAAI,SAAS,GAAG;QACd,OAAO,QAAQ,CAAC,MAAM,GAAG;IAC3B,OAAO;QACL,OAAO,QAAQ,CAAC,IAAI,CAAC;IACvB;IACA,OAAO;AACT;AAEO,eAAe,mBAAmB,OAAe;IACtD,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,WAAW,MAAM,IAAA,4HAAa,EAAqB;QACzD,MAAM,SAAS,SAAS,CAAC;YAAE;QAAQ;QACnC;IACF;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,OAAO,QAAQ,GAAG,OAAO,QAAQ,CAAC,MAAM,CAAC,CAAC,UAAY,QAAQ,OAAO,KAAK;AAC5E;AAEO,eAAe,cAAc,OAAe;IACjD,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,SAAS,MAAM,IAAA,4HAAa,EAAkB;QACpD,MAAM,MAAM,MAAM,OAAO,OAAO,CAAC;YAAE;QAAQ;QAC3C,OAAO,KAAK,SAAS;IACvB;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,MAAM,WAAW,OAAO,UAAU,CAAC,IAAI,CAAC,CAAC,OAAS,KAAK,OAAO,KAAK;IACnE,IAAI,CAAC,UAAU;QACb,MAAM,UAAU;YAAE;YAAS,OAAO;YAAqB,WAAW,IAAI,OAAO,WAAW;QAAG;QAC3F,OAAO,UAAU,CAAC,IAAI,CAAC;QACvB,OAAO,QAAQ,KAAK;IACtB;IACA,OAAO,SAAS,KAAK;AACvB;AAEO,eAAe,eAAe,OAAe,EAAE,KAA2B;IAC/E,MAAM,UAA2B;QAC/B;QACA;QACA,WAAW,IAAI,OAAO,WAAW;IACnC;IACA,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,SAAS,MAAM,IAAA,4HAAa,EAAkB;QACpD,MAAM,OAAO,SAAS,CAAC;YAAE;QAAQ,GAAG;YAAE,MAAM;QAAQ,GAAG;YAAE,QAAQ;QAAK;QACtE,OAAO,QAAQ,KAAK;IACtB;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,MAAM,QAAQ,OAAO,UAAU,CAAC,SAAS,CAAC,CAAC,OAAS,KAAK,OAAO,KAAK;IACrE,IAAI,SAAS,GAAG;QACd,OAAO,UAAU,CAAC,MAAM,GAAG;IAC7B,OAAO;QACL,OAAO,UAAU,CAAC,IAAI,CAAC;IACzB;IACA,OAAO,QAAQ,KAAK;AACtB;AAEO,eAAe,eAAe,OAAoB;IACvD,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,OAAO,MAAM,IAAA,4HAAa,EAAc;QAC9C,MAAM,KAAK,SAAS,CAAC;QACrB,OAAO;IACT;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,OAAO,IAAI,CAAC,IAAI,CAAC;IACjB,OAAO,IAAI,GAAG,OAAO,IAAI,CAAC,KAAK,CAAC,CAAC;IACjC,OAAO;AACT;AAEO,eAAe,iBAAiB,QAAQ,EAAE;IAC/C,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,OAAO,MAAM,IAAA,4HAAa,EAAc;QAC9C,MAAM,OAAO,MAAM,KAAK,IAAI,CAAC,CAAC,GAAG;YAAE,MAAM;gBAAE,WAAW,CAAC;YAAE;QAAE,GAAG,KAAK,CAAC,OAAO,OAAO;QAClF,OAAO,KAAK,OAAO;IACrB;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,OAAO,OAAO,IAAI,CAAC,KAAK,CAAC,CAAC;AAC5B;AAEO,eAAe,WAAW,OAAe;IAC9C,MAAM,QAAwB;QAAE;QAAS,UAAU,IAAI,OAAO,WAAW;IAAG;IAC5E,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,SAAS,MAAM,IAAA,4HAAa,EAAiB;QACnD,MAAM,OAAO,SAAS,CAAC;YAAE;QAAQ,GAAG;YAAE,MAAM;QAAM,GAAG;YAAE,QAAQ;QAAK;QACpE,OAAO;IACT;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,MAAM,QAAQ,OAAO,MAAM,CAAC,SAAS,CAAC,CAAC,IAAM,EAAE,OAAO,KAAK;IAC3D,IAAI,SAAS,GAAG;QACd,OAAO,MAAM,CAAC,MAAM,GAAG;IACzB,OAAO;QACL,OAAO,MAAM,CAAC,IAAI,CAAC;IACrB;IACA,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,SAAS,KAAK,GAAG,KAAK,OAAO;IACnC,IAAI,IAAA,iIAAkB,KAAI;QACxB,MAAM,SAAS,MAAM,IAAA,4HAAa,EAAiB;QACnD,MAAM,OAAO,MAAM,OAChB,IAAI,CAAC;YAAE,UAAU;gBAAE,MAAM,IAAI,KAAK,QAAQ,WAAW;YAAG;QAAE,GAC1D,OAAO;QACV,OAAO;IACT;IAEA,MAAM,SAAS,IAAA,mIAAW;IAC1B,OAAO,OAAO,MAAM,CAAC,MAAM,CAAC,CAAC,IAAM,IAAI,KAAK,EAAE,QAAQ,EAAE,OAAO,MAAM;AACvE;AAEA,SAAS,mBACP,GAAoD;IAEpD,MAAM,eACJ,OAAO,IAAI,GAAG,KAAK,WAAW,IAAI,GAAG,GAAG,IAAI,GAAG,EAAE;IACnD,OAAO;QACL,GAAI,yBAAyB,IAAI;QACjC,KAAK;IACP;AACF;AAEA,SAAS,cAAc,GAAiB;IACtC,MAAM,eACJ,OAAO,IAAI,GAAG,KAAK,WAAW,IAAI,GAAG,GAAG,IAAI,GAAG,EAAE;IACnD,OAAO;QACL,GAAI,oBAAoB,IAAI;QAC5B,KAAK;IACP;AACF;AAEA,SAAS,yBACP,GAAoD;IAEpD,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,GAAG;IACzB,OAAO;QAAE,GAAG,IAAI;IAAC;AACnB;AAEA,SAAS,oBAAoB,GAA0C;IACrE,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,GAAG;IACzB,OAAO;QAAE,GAAG,IAAI;IAAC;AACnB;AAEA,SAAS;IACP,OAAO;QACL;YAAE,IAAI;YAAO,MAAM;YAAgB,UAAU;gBAAE,GAAG;gBAAI,GAAG;YAAG;QAAE;QAC9D;YAAE,IAAI;YAAS,MAAM;YAAgB,UAAU;gBAAE,GAAG;gBAAI,GAAG;YAAG;QAAE;QAChE;YAAE,IAAI;YAAS,MAAM;YAAmB,UAAU;gBAAE,GAAG;gBAAI,GAAG;YAAG;QAAE;QACnE;YAAE,IAAI;YAAQ,MAAM;YAAa,UAAU;gBAAE,GAAG;gBAAK,GAAG;YAAG;QAAE;KAC9D;AACH;AAEA,SAAS;IACP,OAAO;QAAC;QAAM;QAAM;QAAM;KAAK;AACjC;AAEA,SAAS;IACP,OAAO,MAAM,IAAI,CAAC;QAAE,QAAQ;IAAE,GAAG,GAAG,CAAC,CAAC,GAAG,QAAU,CAAC;YAClD,IAAI,CAAC,KAAK,EAAE,QAAQ,GAAG;YACvB,MAAM;YACN,WAAW;YACX,gBAAgB;QAClB,CAAC;AACH"}},
    {"offset": {"line": 731, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/api/auth/service.ts"],"sourcesContent":["import { hashPassword, verifyPassword } from \"@/lib/hash\";\nimport { loginSchema, registerSchema, type User } from \"@/lib/models\";\nimport { findUserByEmail, insertUser } from \"@/lib/repositories\";\n\nexport async function register(payload: unknown) {\n  const data = registerSchema.parse(payload);\n  const existing = await findUserByEmail(data.email);\n  if (existing) {\n    throw new Error(\"Usuário já existe\");\n  }\n\n  const bundle = hashPassword(data.password);\n  const user: User = {\n    email: data.email,\n    passwordHash: bundle.hash,\n    salt: bundle.salt,\n    createdAt: new Date().toISOString()\n  };\n\n  const stored = await insertUser(user);\n  return { id: stored._id, email: stored.email };\n}\n\nexport async function login(payload: unknown) {\n  const data = loginSchema.parse(payload);\n  const user = await findUserByEmail(data.email);\n  if (!user || !verifyPassword(data.password, { hash: user.passwordHash, salt: user.salt })) {\n    throw new Error(\"Credenciais inválidas\");\n  }\n\n  return { id: user._id, email: user.email };\n}\n\nexport async function logout() {\n  return { success: true };\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe,SAAS,OAAgB;IAC7C,MAAM,OAAO,iIAAc,CAAC,KAAK,CAAC;IAClC,MAAM,WAAW,MAAM,IAAA,wIAAe,EAAC,KAAK,KAAK;IACjD,IAAI,UAAU;QACZ,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,SAAS,IAAA,6HAAY,EAAC,KAAK,QAAQ;IACzC,MAAM,OAAa;QACjB,OAAO,KAAK,KAAK;QACjB,cAAc,OAAO,IAAI;QACzB,MAAM,OAAO,IAAI;QACjB,WAAW,IAAI,OAAO,WAAW;IACnC;IAEA,MAAM,SAAS,MAAM,IAAA,mIAAU,EAAC;IAChC,OAAO;QAAE,IAAI,OAAO,GAAG;QAAE,OAAO,OAAO,KAAK;IAAC;AAC/C;AAEO,eAAe,MAAM,OAAgB;IAC1C,MAAM,OAAO,8HAAW,CAAC,KAAK,CAAC;IAC/B,MAAM,OAAO,MAAM,IAAA,wIAAe,EAAC,KAAK,KAAK;IAC7C,IAAI,CAAC,QAAQ,CAAC,IAAA,+HAAc,EAAC,KAAK,QAAQ,EAAE;QAAE,MAAM,KAAK,YAAY;QAAE,MAAM,KAAK,IAAI;IAAC,IAAI;QACzF,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;QAAE,IAAI,KAAK,GAAG;QAAE,OAAO,KAAK,KAAK;IAAC;AAC3C;AAEO,eAAe;IACpB,OAAO;QAAE,SAAS;IAAK;AACzB"}},
    {"offset": {"line": 793, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/apiResponse.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\nexport function ok<T>(data: T, status = 200) {\n  return NextResponse.json(data, { status });\n}\n\nexport function error(message: string, status = 400) {\n  return NextResponse.json({ error: message }, { status });\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,SAAS,GAAM,IAAO,EAAE,SAAS,GAAG;IACzC,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM;QAAE;IAAO;AAC1C;AAEO,SAAS,MAAM,OAAe,EAAE,SAAS,GAAG;IACjD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAQ,GAAG;QAAE;IAAO;AACxD"}},
    {"offset": {"line": 817, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/sessionCookie.ts"],"sourcesContent":["import { cookies } from \"next/headers\";\nimport type { ReadonlyRequestCookies } from \"next/dist/server/web/spec-extension/adapters/request-cookies\";\nimport type { NextResponse } from \"next/server\";\n\nexport const SESSION_COOKIE = \"session_owner\";\n\nconst cookieOptions = {\n  httpOnly: true,\n  sameSite: \"lax\" as const,\n  path: \"/\"\n};\n\nexport function setSessionCookie(response: NextResponse, ownerId: string) {\n  response.cookies.set(SESSION_COOKIE, ownerId, cookieOptions);\n}\n\nexport function clearSessionCookie(response: NextResponse) {\n  response.cookies.set(SESSION_COOKIE, \"\", { ...cookieOptions, maxAge: 0 });\n}\n\nexport async function getSessionOwnerId(store?: ReadonlyRequestCookies) {\n  const cookieStore = store ?? ((await Promise.resolve(cookies())) as ReadonlyRequestCookies);\n  return cookieStore.get(SESSION_COOKIE)?.value ?? null;\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAIO,MAAM,iBAAiB;AAE9B,MAAM,gBAAgB;IACpB,UAAU;IACV,UAAU;IACV,MAAM;AACR;AAEO,SAAS,iBAAiB,QAAsB,EAAE,OAAe;IACtE,SAAS,OAAO,CAAC,GAAG,CAAC,gBAAgB,SAAS;AAChD;AAEO,SAAS,mBAAmB,QAAsB;IACvD,SAAS,OAAO,CAAC,GAAG,CAAC,gBAAgB,IAAI;QAAE,GAAG,aAAa;QAAE,QAAQ;IAAE;AACzE;AAEO,eAAe,kBAAkB,KAA8B;IACpE,MAAM,cAAc,SAAW,MAAM,QAAQ,OAAO,CAAC,IAAA,4IAAO;IAC5D,OAAO,YAAY,GAAG,CAAC,iBAAiB,SAAS;AACnD"}},
    {"offset": {"line": 852, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/app/api/auth/login/route.ts"],"sourcesContent":["import { login } from \"@/api/auth/service\";\nimport { error, ok } from \"@/lib/apiResponse\";\nimport { setSessionCookie } from \"@/lib/sessionCookie\";\n\nexport async function POST(request: Request) {\n  try {\n    const payload = await request.json();\n    const data = await login(payload);\n    const response = ok(data);\n    if (data.id) {\n      setSessionCookie(response, data.id);\n    }\n    return response;\n  } catch (err) {\n    return error(getMessage(err), 401);\n  }\n}\n\nfunction getMessage(err: unknown) {\n  return err instanceof Error ? err.message : \"Falha ao autenticar\";\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,UAAU,MAAM,QAAQ,IAAI;QAClC,MAAM,OAAO,MAAM,IAAA,iIAAK,EAAC;QACzB,MAAM,WAAW,IAAA,0HAAE,EAAC;QACpB,IAAI,KAAK,EAAE,EAAE;YACX,IAAA,0IAAgB,EAAC,UAAU,KAAK,EAAE;QACpC;QACA,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,OAAO,IAAA,6HAAK,EAAC,WAAW,MAAM;IAChC;AACF;AAEA,SAAS,WAAW,GAAY;IAC9B,OAAO,eAAe,QAAQ,IAAI,OAAO,GAAG;AAC9C"}}]
}