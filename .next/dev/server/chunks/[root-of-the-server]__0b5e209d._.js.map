{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/models.ts"],"sourcesContent":["import { z } from \"zod\";\n\nexport type InventoryItem = {\n  id: string;\n  name: string;\n  quantity: number;\n};\n\nexport type User = {\n  _id?: string;\n  email: string;\n  passwordHash: string;\n  salt: string;\n  createdAt: string;\n};\n\nexport type CharacterStats = {\n  level: number;\n  xp: number;\n  hp: number;\n  energy: number;\n};\n\nexport type Character = {\n  _id?: string;\n  ownerId: string;\n  name: string;\n  sprite: string;\n  inventory: InventoryItem[];\n  stats: CharacterStats;\n  createdAt: string;\n  updatedAt: string;\n};\n\nexport type HouseFurniture = {\n  id: string;\n  name: string;\n  position: { x: number; y: number };\n};\n\nexport type HouseState = {\n  ownerId: string;\n  furniture: HouseFurniture[];\n};\n\nexport type FarmPlot = {\n  id: string;\n  seed: string | null;\n  plantedAt: string | null;\n  harvestReadyAt: string | null;\n};\n\nexport type FarmState = {\n  ownerId: string;\n  plots: FarmPlot[];\n};\n\nexport type ChatMessage = {\n  id: string;\n  ownerId: string;\n  message: string;\n  createdAt: string;\n};\n\nexport type OnlinePresence = {\n  ownerId: string;\n  lastPing: string;\n};\n\nexport const registerSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6)\n});\n\nexport const loginSchema = registerSchema;\n\nexport const characterCreateSchema = z.object({\n  ownerId: z.string().min(1),\n  name: z.string().min(3).max(20),\n  sprite: z.string().min(1)\n});\n\nexport const onlinePingSchema = z.object({\n  ownerId: z.string().min(1)\n});\n\nexport const inventoryItemSchema = z.object({\n  id: z.string().min(1),\n  name: z.string().min(1),\n  quantity: z.number().int().min(1)\n});\n\nexport const inventoryAddSchema = z.object({\n  ownerId: z.string().min(1),\n  item: inventoryItemSchema\n});\n\nexport const inventoryRemoveSchema = z.object({\n  ownerId: z.string().min(1),\n  itemId: z.string().min(1),\n  quantity: z.number().int().min(1)\n});\n\nexport const chatSendSchema = z.object({\n  ownerId: z.string().min(1),\n  message: z.string().min(1).max(280)\n});\n\nexport const houseUpdateSchema = z.object({\n  ownerId: z.string().min(1),\n  furniture: z\n    .array(\n      z.object({\n        id: z.string().min(1),\n        name: z.string().min(1),\n        position: z.object({\n          x: z.number().min(0),\n          y: z.number().min(0)\n        })\n      })\n    )\n    .max(4)\n});\n\nexport const farmPlantSchema = z.object({\n  ownerId: z.string().min(1),\n  plotId: z.string().min(1),\n  seed: z.string().min(1)\n});\n\nexport const farmHarvestSchema = z.object({\n  ownerId: z.string().min(1),\n  plotId: z.string().min(1)\n});\n\nexport const forestKillSchema = z.object({\n  ownerId: z.string().min(1)\n});\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAqEO,MAAM,iBAAiB,oLAAC,CAAC,MAAM,CAAC;IACrC,OAAO,oLAAC,CAAC,MAAM,GAAG,KAAK;IACvB,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC3B;AAEO,MAAM,cAAc;AAEpB,MAAM,wBAAwB,oLAAC,CAAC,MAAM,CAAC;IAC5C,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;IAC5B,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AACzB;AAEO,MAAM,mBAAmB,oLAAC,CAAC,MAAM,CAAC;IACvC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC1B;AAEO,MAAM,sBAAsB,oLAAC,CAAC,MAAM,CAAC;IAC1C,IAAI,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACnB,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACrB,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC;AACjC;AAEO,MAAM,qBAAqB,oLAAC,CAAC,MAAM,CAAC;IACzC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,MAAM;AACR;AAEO,MAAM,wBAAwB,oLAAC,CAAC,MAAM,CAAC;IAC5C,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACvB,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC;AACjC;AAEO,MAAM,iBAAiB,oLAAC,CAAC,MAAM,CAAC;IACrC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;AACjC;AAEO,MAAM,oBAAoB,oLAAC,CAAC,MAAM,CAAC;IACxC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,WAAW,oLAAC,CACT,KAAK,CACJ,oLAAC,CAAC,MAAM,CAAC;QACP,IAAI,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACnB,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACrB,UAAU,oLAAC,CAAC,MAAM,CAAC;YACjB,GAAG,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;YAClB,GAAG,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACpB;IACF,IAED,GAAG,CAAC;AACT;AAEO,MAAM,kBAAkB,oLAAC,CAAC,MAAM,CAAC;IACtC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACvB,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AACvB;AAEO,MAAM,oBAAoB,oLAAC,CAAC,MAAM,CAAC;IACxC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACxB,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AACzB;AAEO,MAAM,mBAAmB,oLAAC,CAAC,MAAM,CAAC;IACvC,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC1B"}},
    {"offset": {"line": 132, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/db.ts"],"sourcesContent":["import { MongoClient, Collection, type Document } from \"mongodb\";\n\nlet client: MongoClient | null = null;\n\nconst uri = process.env.MONGODB_URI;\n\nasync function getClient() {\n  if (!uri) {\n    throw new Error(\"MONGODB_URI não configurado\");\n  }\n\n  if (!client) {\n    client = new MongoClient(uri);\n    await client.connect();\n  }\n\n  return client;\n}\n\nexport async function getCollection<T extends Document = Document>(\n  name: string\n): Promise<Collection<T>> {\n  const cli = await getClient();\n  return cli.db(\"spinazzi\").collection<T>(name);\n}\n\nexport function hasMongoConnection() {\n  return Boolean(uri);\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,SAA6B;AAEjC,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AAEnC,eAAe;IACb,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,CAAC,QAAQ;QACX,SAAS,IAAI,sHAAW,CAAC;QACzB,MAAM,OAAO,OAAO;IACtB;IAEA,OAAO;AACT;AAEO,eAAe,cACpB,IAAY;IAEZ,MAAM,MAAM,MAAM;IAClB,OAAO,IAAI,EAAE,CAAC,YAAY,UAAU,CAAI;AAC1C;AAEO,SAAS;IACd,OAAO,QAAQ;AACjB"}},
    {"offset": {"line": 163, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/memoryStore.ts"],"sourcesContent":["import type {\n  ChatMessage,\n  Character,\n  FarmState,\n  HouseState,\n  InventoryItem,\n  OnlinePresence,\n  User\n} from \"./models\";\n\ntype MemoryDB = {\n  users: User[];\n  characters: Character[];\n  inventory: Record<string, InventoryItem[]>;\n  houses: HouseState[];\n  farms: FarmState[];\n  chat: ChatMessage[];\n  online: OnlinePresence[];\n};\n\nconst memoryDb: MemoryDB = {\n  users: [],\n  characters: [],\n  inventory: {},\n  houses: [],\n  farms: [],\n  chat: [],\n  online: []\n};\n\nexport function getMemoryDB() {\n  return memoryDb;\n}\n"],"names":[],"mappings":";;;;AAoBA,MAAM,WAAqB;IACzB,OAAO,EAAE;IACT,YAAY,EAAE;IACd,WAAW,CAAC;IACZ,QAAQ,EAAE;IACV,OAAO,EAAE;IACT,MAAM,EAAE;IACR,QAAQ,EAAE;AACZ;AAEO,SAAS;IACd,OAAO;AACT"}},
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/repositories.ts"],"sourcesContent":["import { ObjectId, type OptionalUnlessRequiredId } from \"mongodb\";\nimport { getCollection, hasMongoConnection } from \"./db\";\nimport { getMemoryDB } from \"./memoryStore\";\nimport type {\n  ChatMessage,\n  Character,\n  FarmState,\n  HouseState,\n  InventoryItem,\n  OnlinePresence,\n  User\n} from \"./models\";\n\ntype CharacterDocument = Omit<Character, \"_id\"> & { _id: ObjectId };\ntype UserDocument = Omit<User, \"_id\"> & { _id: ObjectId };\n\nexport async function findUserByEmail(email: string) {\n  if (hasMongoConnection()) {\n    const users = await getCollection<UserDocument>(\"users\");\n    const doc = await users.findOne({ email });\n    return doc ? normalizeUser(doc) : null;\n  }\n\n  const memory = getMemoryDB();\n  return memory.users.find((user) => user.email === email) ?? null;\n}\n\nexport async function insertUser(user: User) {\n  if (hasMongoConnection()) {\n    const users = await getCollection<UserDocument>(\"users\");\n    const { _id, ...doc } = user;\n    const result = await users.insertOne(doc as OptionalUnlessRequiredId<UserDocument>);\n    return { ...doc, _id: String(result.insertedId) };\n  }\n\n  const memory = getMemoryDB();\n  const stored = { ...user, _id: new ObjectId().toHexString() };\n  memory.users.push(stored);\n  return stored;\n}\n\nexport async function countCharacters(ownerId: string) {\n  if (hasMongoConnection()) {\n    const characters = await getCollection<CharacterDocument>(\"characters\");\n    return characters.countDocuments({ ownerId });\n  }\n\n  const memory = getMemoryDB();\n  return memory.characters.filter((c) => c.ownerId === ownerId).length;\n}\n\nexport async function insertCharacter(character: Character) {\n  if (hasMongoConnection()) {\n    const characters = await getCollection<CharacterDocument>(\"characters\");\n    const { _id, ...doc } = character;\n    const result = await characters.insertOne(\n      doc as OptionalUnlessRequiredId<CharacterDocument>\n    );\n    return { ...doc, _id: String(result.insertedId) };\n  }\n\n  const memory = getMemoryDB();\n  const stored = { ...character, _id: new ObjectId().toHexString() };\n  memory.characters.push(stored);\n  return stored;\n}\n\nexport async function listCharacters(ownerId: string) {\n  if (hasMongoConnection()) {\n    const characters = await getCollection<CharacterDocument>(\"characters\");\n    const docs = await characters\n      .find({ ownerId })\n      .sort({ createdAt: 1 })\n      .limit(4)\n      .toArray();\n    return docs.map((doc) => normalizeCharacter(doc));\n  }\n\n  const memory = getMemoryDB();\n  return memory.characters.filter((c) => c.ownerId === ownerId).map((c) => ({ ...c }));\n}\n\nexport async function findCharacterById(ownerId: string, characterId: string) {\n  if (hasMongoConnection()) {\n    if (!ObjectId.isValid(characterId)) {\n      return null;\n    }\n    const characters = await getCollection<CharacterDocument>(\"characters\");\n    const doc = await characters.findOne({ ownerId, _id: new ObjectId(characterId) });\n    return doc ? normalizeCharacter(doc) : null;\n  }\n\n  const memory = getMemoryDB();\n  const character = memory.characters.find(\n    (c) => c.ownerId === ownerId && c._id === characterId\n  );\n  return character ? { ...character } : null;\n}\n\nexport async function getInventory(ownerId: string) {\n  if (hasMongoConnection()) {\n    const inventory = await getCollection<{ ownerId: string; items: InventoryItem[] }>(\"inventory\");\n    const doc = await inventory.findOne({ ownerId });\n    return doc?.items ?? [];\n  }\n\n  const memory = getMemoryDB();\n  const items = memory.inventory[ownerId] ?? [];\n  memory.inventory[ownerId] = items;\n  return items;\n}\n\nexport async function saveInventory(ownerId: string, items: InventoryItem[]) {\n  if (hasMongoConnection()) {\n    const inventory = await getCollection<{ ownerId: string; items: InventoryItem[] }>(\"inventory\");\n    await inventory.updateOne(\n      { ownerId },\n      { $set: { ownerId, items } },\n      { upsert: true }\n    );\n    return items;\n  }\n\n  const memory = getMemoryDB();\n  memory.inventory[ownerId] = items;\n  return items;\n}\n\nexport async function getHouse(ownerId: string): Promise<HouseState> {\n  if (hasMongoConnection()) {\n    const houses = await getCollection<HouseState>(\"houses\");\n    const doc = await houses.findOne({ ownerId });\n    return (\n      doc ?? {\n        ownerId,\n        furniture: defaultFurniture()\n      }\n    );\n  }\n\n  const memory = getMemoryDB();\n  let house = memory.houses.find((h) => h.ownerId === ownerId);\n  if (!house) {\n    house = { ownerId, furniture: defaultFurniture() };\n    memory.houses.push(house);\n  }\n  return house;\n}\n\nexport async function updateHouse(ownerId: string, furniture: HouseState[\"furniture\"]) {\n  const state = { ownerId, furniture };\n  if (hasMongoConnection()) {\n    const houses = await getCollection<HouseState>(\"houses\");\n    await houses.updateOne({ ownerId }, { $set: state }, { upsert: true });\n    return state;\n  }\n\n  const memory = getMemoryDB();\n  const index = memory.houses.findIndex((h) => h.ownerId === ownerId);\n  if (index >= 0) {\n    memory.houses[index] = state;\n    return state;\n  }\n  memory.houses.push(state);\n  return state;\n}\n\nexport async function getFarm(ownerId: string): Promise<FarmState> {\n  if (hasMongoConnection()) {\n    const farms = await getCollection<FarmState>(\"farms\");\n    const doc = await farms.findOne({ ownerId });\n    return doc ?? { ownerId, plots: defaultFarmPlots() };\n  }\n\n  const memory = getMemoryDB();\n  let farm = memory.farms.find((f) => f.ownerId === ownerId);\n  if (!farm) {\n    farm = { ownerId, plots: defaultFarmPlots() };\n    memory.farms.push(farm);\n  }\n  return farm;\n}\n\nexport async function saveFarm(state: FarmState) {\n  if (hasMongoConnection()) {\n    const farms = await getCollection<FarmState>(\"farms\");\n    await farms.updateOne({ ownerId: state.ownerId }, { $set: state }, { upsert: true });\n    return state;\n  }\n\n  const memory = getMemoryDB();\n  const index = memory.farms.findIndex((f) => f.ownerId === state.ownerId);\n  if (index >= 0) {\n    memory.farms[index] = state;\n    return state;\n  }\n  memory.farms.push(state);\n  return state;\n}\n\nexport async function addChatMessage(message: ChatMessage) {\n  if (hasMongoConnection()) {\n    const chat = await getCollection<ChatMessage>(\"chat\");\n    await chat.insertOne(message);\n    return message;\n  }\n\n  const memory = getMemoryDB();\n  memory.chat.push(message);\n  memory.chat = memory.chat.slice(-50);\n  return message;\n}\n\nexport async function listChatMessages(limit = 20) {\n  if (hasMongoConnection()) {\n    const chat = await getCollection<ChatMessage>(\"chat\");\n    const docs = await chat.find({}, { sort: { createdAt: -1 } }).limit(limit).toArray();\n    return docs.reverse();\n  }\n\n  const memory = getMemoryDB();\n  return memory.chat.slice(-limit);\n}\n\nexport async function pingOnline(ownerId: string) {\n  const entry: OnlinePresence = { ownerId, lastPing: new Date().toISOString() };\n  if (hasMongoConnection()) {\n    const online = await getCollection<OnlinePresence>(\"online\");\n    await online.updateOne({ ownerId }, { $set: entry }, { upsert: true });\n    return entry;\n  }\n\n  const memory = getMemoryDB();\n  const index = memory.online.findIndex((o) => o.ownerId === ownerId);\n  if (index >= 0) {\n    memory.online[index] = entry;\n  } else {\n    memory.online.push(entry);\n  }\n  return entry;\n}\n\nexport async function listOnline() {\n  const cutoff = Date.now() - 1000 * 60;\n  if (hasMongoConnection()) {\n    const online = await getCollection<OnlinePresence>(\"online\");\n    const docs = await online\n      .find({ lastPing: { $gte: new Date(cutoff).toISOString() } })\n      .toArray();\n    return docs;\n  }\n\n  const memory = getMemoryDB();\n  return memory.online.filter((o) => new Date(o.lastPing).getTime() >= cutoff);\n}\n\nfunction normalizeCharacter(\n  doc: CharacterDocument | (Character & { _id?: any })\n): Character {\n  const normalizedId =\n    typeof doc._id === \"string\" ? doc._id : doc._id?.toString?.();\n  return {\n    ...(structuredCloneCharacter(doc)),\n    _id: normalizedId\n  };\n}\n\nfunction normalizeUser(doc: UserDocument): User {\n  const normalizedId =\n    typeof doc._id === \"string\" ? doc._id : doc._id?.toString?.();\n  return {\n    ...(structuredCloneUser(doc)),\n    _id: normalizedId\n  };\n}\n\nfunction structuredCloneCharacter(\n  doc: CharacterDocument | (Character & { _id?: any })\n): Character {\n  const { _id, ...rest } = doc as Character;\n  return { ...rest };\n}\n\nfunction structuredCloneUser(doc: UserDocument | (User & { _id?: any })): User {\n  const { _id, ...rest } = doc as User;\n  return { ...rest };\n}\n\nfunction defaultFurniture() {\n  return [\n    { id: \"bed\", name: \"Cama Simples\", position: { x: 64, y: 32 } },\n    { id: \"table\", name: \"Mesa Madeira\", position: { x: 32, y: 96 } },\n    { id: \"shelf\", name: \"Estante Pequena\", position: { x: 96, y: 32 } },\n    { id: \"lamp\", name: \"Lamparina\", position: { x: 128, y: 96 } }\n  ];\n}\n\nfunction defaultFarmPlots() {\n  return Array.from({ length: 4 }).map((_, index) => ({\n    id: `plot-${index + 1}`,\n    seed: null,\n    plantedAt: null,\n    harvestReadyAt: null\n  }));\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 574, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/api/farm/service.ts"],"sourcesContent":["import { farmHarvestSchema, farmPlantSchema } from \"@/lib/models\";\nimport { getFarm, saveFarm } from \"@/lib/repositories\";\n\nexport async function loadFarm(ownerId: string) {\n  return getFarm(ownerId);\n}\n\nexport async function plant(payload: unknown) {\n  const data = farmPlantSchema.parse(payload);\n  const farm = await getFarm(data.ownerId);\n  const plot = farm.plots.find((p) => p.id === data.plotId);\n  if (!plot) {\n    throw new Error(\"Talhão inválido\");\n  }\n  if (plot.seed) {\n    throw new Error(\"Talhão ocupado\");\n  }\n  const plantedAt = new Date();\n  plot.seed = data.seed;\n  plot.plantedAt = plantedAt.toISOString();\n  plot.harvestReadyAt = new Date(plantedAt.getTime() + 1000 * 60 * 5).toISOString();\n  await saveFarm(farm);\n  return farm;\n}\n\nexport async function harvest(payload: unknown) {\n  const data = farmHarvestSchema.parse(payload);\n  const farm = await getFarm(data.ownerId);\n  const plot = farm.plots.find((p) => p.id === data.plotId);\n  if (!plot || !plot.seed) {\n    throw new Error(\"Nada para colher\");\n  }\n  plot.seed = null;\n  plot.plantedAt = null;\n  plot.harvestReadyAt = null;\n  await saveFarm(farm);\n  return farm;\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEO,eAAe,SAAS,OAAe;IAC5C,OAAO,IAAA,gIAAO,EAAC;AACjB;AAEO,eAAe,MAAM,OAAgB;IAC1C,MAAM,OAAO,kIAAe,CAAC,KAAK,CAAC;IACnC,MAAM,OAAO,MAAM,IAAA,gIAAO,EAAC,KAAK,OAAO;IACvC,MAAM,OAAO,KAAK,KAAK,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,KAAK,MAAM;IACxD,IAAI,CAAC,MAAM;QACT,MAAM,IAAI,MAAM;IAClB;IACA,IAAI,KAAK,IAAI,EAAE;QACb,MAAM,IAAI,MAAM;IAClB;IACA,MAAM,YAAY,IAAI;IACtB,KAAK,IAAI,GAAG,KAAK,IAAI;IACrB,KAAK,SAAS,GAAG,UAAU,WAAW;IACtC,KAAK,cAAc,GAAG,IAAI,KAAK,UAAU,OAAO,KAAK,OAAO,KAAK,GAAG,WAAW;IAC/E,MAAM,IAAA,iIAAQ,EAAC;IACf,OAAO;AACT;AAEO,eAAe,QAAQ,OAAgB;IAC5C,MAAM,OAAO,oIAAiB,CAAC,KAAK,CAAC;IACrC,MAAM,OAAO,MAAM,IAAA,gIAAO,EAAC,KAAK,OAAO;IACvC,MAAM,OAAO,KAAK,KAAK,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,KAAK,MAAM;IACxD,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,EAAE;QACvB,MAAM,IAAI,MAAM;IAClB;IACA,KAAK,IAAI,GAAG;IACZ,KAAK,SAAS,GAAG;IACjB,KAAK,cAAc,GAAG;IACtB,MAAM,IAAA,iIAAQ,EAAC;IACf,OAAO;AACT"}},
    {"offset": {"line": 629, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/lib/apiResponse.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\nexport function ok<T>(data: T, status = 200) {\n  return NextResponse.json(data, { status });\n}\n\nexport function error(message: string, status = 400) {\n  return NextResponse.json({ error: message }, { status });\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,SAAS,GAAM,IAAO,EAAE,SAAS,GAAG;IACzC,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM;QAAE;IAAO;AAC1C;AAEO,SAAS,MAAM,OAAe,EAAE,SAAS,GAAG;IACjD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAQ,GAAG;QAAE;IAAO;AACxD"}},
    {"offset": {"line": 653, "column": 0}, "map": {"version":3,"sources":["file:///Users/diegovellasco/simplegame/app/api/farm/harvest/route.ts"],"sourcesContent":["import { harvest } from \"@/api/farm/service\";\nimport { error, ok } from \"@/lib/apiResponse\";\n\nexport async function POST(request: Request) {\n  try {\n    const payload = await request.json();\n    const farm = await harvest(payload);\n    return ok(farm);\n  } catch (err) {\n    return error(getMessage(err), 400);\n  }\n}\n\nfunction getMessage(err: unknown) {\n  return err instanceof Error ? err.message : \"Falha ao colher\";\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,UAAU,MAAM,QAAQ,IAAI;QAClC,MAAM,OAAO,MAAM,IAAA,mIAAO,EAAC;QAC3B,OAAO,IAAA,0HAAE,EAAC;IACZ,EAAE,OAAO,KAAK;QACZ,OAAO,IAAA,6HAAK,EAAC,WAAW,MAAM;IAChC;AACF;AAEA,SAAS,WAAW,GAAY;IAC9B,OAAO,eAAe,QAAQ,IAAI,OAAO,GAAG;AAC9C"}}]
}